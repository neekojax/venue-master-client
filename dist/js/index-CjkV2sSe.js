var _=(i,c,x)=>new Promise((f,s)=>{var d=p=>{try{l(x.next(p))}catch(g){s(g)}},n=p=>{try{l(x.throw(p))}catch(g){s(g)}},l=p=>p.done?f(p.value):Promise.resolve(p.value).then(d,n);l((x=x.apply(i,c)).next())});import{j as e,a as Q,b as X}from"./index-Cy3mA6Hd.js";import{r as h}from"./react-BIszHAjf.js";import{u as k,w as K}from"./xlsx-DaVhO591.js";import"./index-Cd3bGM7W.js";import{d as U}from"./install-Dn5CJfUk.js";import{j as $,k as m,bf as L,h as z,bg as B,_ as Y,T as y,b5 as Z,bh as ee,bi as te,bj as ie,Z as oe,q as re,B as le,be as se,W as ne,z as H,U as D}from"./antd-D8kp0uix.js";import{a as ae}from"./api-CEb9G4aj.js";import"./install-52PPXTA7.js";import"./fetchHelper-BXyJn6jC.js";const ce=i=>{const c=h.useRef(null),{effective:x,theoretical:f}=i,s=f>0?x/f*100:0;return console.log(s),h.useEffect(()=>{const d=U(c.current),n={series:[{type:"gauge",startAngle:210,endAngle:-30,min:0,max:100,splitNumber:5,radius:"90%",center:["50%","55%"],axisLine:{lineStyle:{width:15,color:[[.6,"#ff4d4f"],[.8,"#fa8c16"],[1,"#52c41a"]]}},pointer:{width:8},detail:{valueAnimation:!0,formatter:"{value}%",fontSize:20,offsetCenter:[0,80]},data:[{value:s.toFixed(2)}]}]};return d.setOption(n),()=>{d.dispose()}},[s]),e.jsx("div",{ref:c,style:{height:200,width:"100%"}})},W=i=>{var d;const{values:c,colors:x}=i,f=c.reduce((n,l)=>n+l,0),s=c.map(n=>n/f*100);return e.jsxs("div",{style:{width:"100%"},children:[e.jsx("div",{style:{display:"flex",marginBottom:4,width:"100%"},children:c.map((n,l)=>l===2?null:e.jsx("div",{style:{width:`${s[l]}%`,fontWeight:"bold",fontSize:14,color:"#000",whiteSpace:"nowrap",textAlign:l===0?"left":l===1?"center":"right",paddingLeft:l===0?4:0,paddingRight:l===c.length-1?4:0,boxSizing:"border-box",visibility:l===3?"hidden":"visible"},title:`${s[l].toFixed(2)}%`,children:n!=0&&e.jsxs("div",{children:[n,"%"]})},l))}),e.jsx("div",{style:{display:"flex",width:"100%",height:20,borderRadius:4,overflow:"hidden"},children:s.map((n,l)=>e.jsx("div",{style:{width:`${n}%`,backgroundColor:x[l],borderTopLeftRadius:l===0?4:0,borderBottomLeftRadius:l===0?4:0,borderTopRightRadius:l===s.length-1?4:0,borderBottomRightRadius:l===s.length-1?4:0,transition:"width 0.3s ease"}},l))}),e.jsxs("div",{style:{marginTop:4,width:`${s[2]}%`,fontWeight:"bold",fontSize:14,color:"#000",textAlign:"center",marginLeft:`calc(${s.slice(0,2).reduce((n,l)=>n+l,0)}%)`,boxSizing:"border-box",whiteSpace:"nowrap",visibility:c.length===1?"hidden":"visible"},title:`${(d=s[2])==null?void 0:d.toFixed(2)}%`,children:[c[2],"%"]})]})},he=({data:i,loading:c})=>{var n,l,p,g,b,N,A,O,v;const x=h.useRef(null),f=h.useRef(null),s=i.totalFailures24h/i.totalMachines*100,d=i.totalPowerImpact/i.totalTheoreticalPower*100;return h.useEffect(()=>{if(x.current){f.current=U(x.current);const j=i.totalEstimateOnRackMachines,S=i.totalEstimateOnlineMachines,F=i.totalMachines,R={tooltip:{trigger:"item"},grid:{top:-10,bottom:0,left:0,right:0},series:[{name:"总数",type:"pie",radius:["80%","100%"],label:{show:!1,position:"center",formatter:`{b}
{c}`},data:[{value:F,name:"总数",itemStyle:{color:"#fa8c16"}}]},{name:"在架数",type:"pie",radius:["55%","75%"],label:{show:!1},data:[{value:j,name:"在架",itemStyle:{color:"#1890ff"}},{value:F-j,name:"未在架",itemStyle:{color:"transparent"}}]},{name:"在线数",type:"pie",radius:["30%","50%"],label:{show:!1},data:[{value:S,name:"在线",itemStyle:{color:"#52c41a"}},{value:j-S,name:"不在线",itemStyle:{color:"transparent"}}]}]};f.current.setOption(R);const C=()=>f.current&&f.current.resize();window.addEventListener("resize",C)}},[i]),e.jsx(e.Fragment,{children:e.jsxs($,{gutter:16,"v-else":!0,children:[e.jsx(m,{span:8,children:e.jsx(L,{loading:c,active:!0,children:e.jsxs(z,{title:"机器汇总",bordered:!1,actions:[e.jsxs("span",{children:[e.jsx(B,{style:{color:"red",fontSize:16,marginRight:"10px"}}),e.jsxs("span",{children:["故障率：",(i.totalFailures24h/i.totalMachines*100).toFixed(2),"%"]})]},"setting"),e.jsxs("span",{children:[e.jsx(Y,{style:{color:"green",fontSize:16,marginRight:"10px"}}),e.jsxs("span",{children:["在线率：",(n=i.totalOnlineRatio)==null?void 0:n.toFixed(2),"%"]})]},"setting")],children:[e.jsxs($,{justify:"space-between",align:"middle",children:[e.jsxs(m,{span:12,style:{textAlign:"left"},children:[e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"托管台数："}),e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalMachines})]}),e.jsxs(m,{span:12,style:{textAlign:"right"},children:[e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"在架台数："}),e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalEstimateOnRackMachines})]}),e.jsxs(m,{span:12,style:{textAlign:"left"},children:[e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"故障台数："}),e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalFailures24h})]}),e.jsxs(m,{span:12,style:{textAlign:"right"},children:[e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"在线台数："}),e.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:((i==null?void 0:i.totalEstimateOnlineMachines)||0).toFixed(0)})]})]}),e.jsx("div",{ref:x,style:{width:"100%",height:168,marginTop:0,marginBottom:0}})]})})}),e.jsx(m,{span:8,children:e.jsx(L,{loading:c,active:!0,children:e.jsxs(z,{title:"算力汇总",bordered:!1,actions:[e.jsxs("span",{children:[e.jsx(Z,{style:{fontSize:16,color:"#1890ff",marginRight:"10px"}}),e.jsxs("span",{children:["算力有效率：",(l=(i==null?void 0:i.averageEffectiveRate)||0)==null?void 0:l.toFixed(2),"%"]})]},"setting")],children:[e.jsxs($,{justify:"space-between",align:"middle",children:[e.jsxs(m,{span:12,style:{textAlign:"left"},children:["有效算力：",((i==null?void 0:i.totalTheoreticalPower)*(i==null?void 0:i.averageEffectiveRate)/100).toFixed(2),"  EH/S"]}),e.jsxs(m,{span:12,style:{textAlign:"right"},children:["理论算力：",(p=i==null?void 0:i.totalTheoreticalPower)==null?void 0:p.toFixed(2),"  EH/S"]})]}),e.jsx(ce,{effective:(i==null?void 0:i.totalTheoreticalPower)*(i==null?void 0:i.averageEffectiveRate)/100,theoretical:i==null?void 0:i.totalTheoreticalPower})]})})}),e.jsx(m,{span:8,children:e.jsx(L,{loading:c,active:!0,children:e.jsxs(z,{title:"影响占比",children:[e.jsx("div",{style:{height:"20px"}}),e.jsx(W,{values:[Number(d==null?void 0:d.toFixed(2))],colors:["#52c41a","#ff4d4f","#faad14"]}),e.jsx("div",{style:{height:"30px"}}),e.jsx(W,{values:[Number(s==null?void 0:s.toFixed(2)),Number((g=i.totalLimitImpactRatio)==null?void 0:g.toFixed(2)),Number((b=i.totalHighTemperatureImpactRatio)==null?void 0:b.toFixed(2)),d-Number(s==null?void 0:s.toFixed(2))-Number((N=i.totalLimitImpactRatio)==null?void 0:N.toFixed(2))-Number((A=i.totalHighTemperatureImpactRatio)==null?void 0:A.toFixed(2))],colors:["#1890ff","#ff4d4f","#faad14"]}),e.jsxs("div",{style:{marginTop:25,marginBottom:-20,display:"flex",flexWrap:"wrap",borderTop:"1px solid #e8e8e8"},children:[e.jsxs($,{justify:"space-between",align:"middle",style:{padding:12},children:[e.jsxs(m,{span:12,style:{textAlign:"left"},children:[e.jsx(ee,{style:{color:"#faad14",marginRight:8}}),"影响占比：",d==null?void 0:d.toFixed(2),"%"]}),e.jsxs(m,{span:12,style:{textAlign:"right"},children:[e.jsx(B,{style:{color:"#ff4d4f",marginRight:8}}),"总故障率：",s==null?void 0:s.toFixed(2),"%"]}),e.jsxs(m,{span:12,style:{textAlign:"left"},children:[e.jsx(te,{style:{color:"#faad14",marginRight:8}}),"限电占比：",(O=i.totalLimitImpactRatio)==null?void 0:O.toFixed(2),"%"]}),e.jsxs(m,{span:12,style:{textAlign:"right"},children:[e.jsx(ie,{style:{color:"#ff4d4f",marginRight:8}}),"高温占比：",(v=i.totalHighTemperatureImpactRatio)==null?void 0:v.toFixed(2),"%"]})]}),e.jsx("div",{})]})]})})})]})})},je=()=>{const{poolType:i}=Q(X(["poolType"])),[c,x]=h.useState(!1),f=h.useRef(null),[s,d]=h.useState(!1);h.useEffect(()=>{const t=()=>{if(f.current){const o=f.current.getBoundingClientRect().top;d(o<=0)}};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const n=new Date;n.setDate(n.getDate()-1);const l=n.toISOString().split("T")[0],[p,g]=h.useState(l),[b,N]=h.useState([]),A=t=>{N(t)},[O,v]=h.useState({}),[j,S]=h.useState([]),[F,R]=h.useState([]),[C,P]=h.useState([]),[q,J]=h.useState(20),V=[{title:"场地名",dataIndex:"venueName",key:"venueName",fixed:"left",width:200,render:t=>{const o=t==="Arct-HF01-J XP-AR-US"||t==="ARCT Technologies-HF02-AR-US";return e.jsx(H,{title:t,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsxs("div",{style:{width:"100%",overflow:"hidden",color:o?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:o?"bold":"normal"},children:[o&&e.jsx(D,{color:"red",style:{marginLeft:2},children:"补充"}),t]})})},sorter:(t,o)=>t.venueName.localeCompare(o.venueName),defaultSortOrder:"ascend"},{title:"账户名",dataIndex:"accountName",key:"accountName",fixed:"left",width:170,render:(t,o)=>{const u=o.ownerType===0?e.jsx(D,{color:"blue",style:{padding:"0px 2px"},children:"自营"}):e.jsx(D,{color:"green",style:{padding:"0px 2px"},children:"客户"});return e.jsxs(e.Fragment,{children:[`${t}`,"  ",u]})}},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:t=>t.toFixed(8),sorter:(t,o)=>t.btcOutput24h-o.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:t=>t.toFixed(6),sorter:(t,o)=>t.theoreticalPower-o.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:t=>t.toFixed(6),sorter:(t,o)=>t.power24h-o.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:t=>`${t.toFixed(2)}%`,sorter:(t,o)=>t.effectiveRate24h-o.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:t=>t.toLocaleString(),sorter:(t,o)=>t.totalMachines-o.totalMachines},{title:"在线数",dataIndex:"onlineMachines",key:"onlineMachines",width:100,align:"right"},{title:"在线率",dataIndex:"onlineRatio",key:"onlineRatio",width:100,align:"right",render:t=>e.jsx("span",{children:`${t}%`})},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:t=>e.jsx("span",{children:t}),sorter:(t,o)=>t.totalFailures-o.totalFailures},{title:"总故障率",dataIndex:"totalFailures",key:"totalMachines",width:100,align:"right",render:(t,o)=>{if(Number(o.totalMachines)===0)return e.jsx("span",{children:"0%"});const u=(t/o.totalMachines*100).toFixed(2);return e.jsx("span",{children:`${u}%`})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:t=>t.toLocaleString(),sorter:(t,o)=>t.failures24h-o.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:t=>({children:`${t.toFixed(2)}%`,props:{style:{color:t>20?"#ff4d4f":"inherit"}}}),sorter:(t,o)=>t.failureRate24h-o.failureRate24h},{title:"影响算力(E)",dataIndex:"powerImpact",key:"powerImpact",width:130,align:"right",render:t=>t.toFixed(6),sorter:(t,o)=>t.powerImpact-o.powerImpact},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:t=>`${t.toFixed(2)}%`,sorter:(t,o)=>t.impactRatio-o.impactRatio},{title:"影响产出(BTC)",dataIndex:"outputImpact",key:"outputImpact",width:145,align:"right",render:t=>t.toFixed(8),sorter:(t,o)=>t.outputImpact-o.outputImpact},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:t=>`${t.toFixed(2)}%`,sorter:(t,o)=>t.limitImpactRate-o.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:t=>`${t.toFixed(2)}%`,sorter:(t,o)=>t.highTemperatureRate-o.highTemperatureRate},{title:"事件描述",dataIndex:"events",key:"events",width:400,render:t=>e.jsx(H,{title:t,children:e.jsx("div",{className:"line-clamp-2",children:t})})}];h.useEffect(()=>{x(!0),_(void 0,null,function*(){const o=Array.isArray(p)?p[0]:p;try{const u=yield ae(i,o);if(u&&u.data&&u.data.dailyReportStatistics){const M=u.data.dailyReportStatistics,E=u.data.summary,I=Object.keys(M).map(w=>{const a=M[w];return{key:w,venueName:a.venue_name,accountId:a.account_id,accountName:a.account_name,ownerType:a.owner_type,btcOutput24h:a.btcOutput24h||0,theoreticalPower:a.theoreticalPower||0,power24h:a.power24h||0,effectiveRate24h:a.effectiveRate24h||0,totalMachines:a.totalMachines||0,totalFailures:a.totalFailures||0,onlineMachines:a.onlineMachines||0,onlineRatio:a.onlineRatio||0,failures24h:a.failures24h||0,failureRate24h:a.failureRate24h||0,powerImpact:a.powerImpact||0,impactRatio:a.impactRatio||0,outputImpact:a.outputImpact||0,limitImpactRate:a.limitImpactRate||0,highTemperatureRate:a.highTemperatureRate||0,events:a.events||""}});S(I),R(I);const r=I.map(w=>({value:w.accountName,label:w.accountName})),T=Array.from(new Map(r.map(w=>[w.value,w])).values());P(T),v(E)}else P([]),R([]),S([]),v({}),console.error("API 返回的 dailyReportStatistics 无效:",u);x(!1)}catch(u){P([]),R([]),S([]),v({}),x(!1),console.error("获取日报数据失败:",u)}})},[p,i]),h.useEffect(()=>{if(b.length>0){console.log(b);const t=j.filter(o=>b.includes(o.accountName));R(t.sort((o,u)=>o.accountName.localeCompare(u.accountName)))}else R(j.sort((t,o)=>t.accountName.localeCompare(o.accountName)))},[b,j]);const G=()=>{const t=F.map(r=>({场地名:r.venueName,账户名:r.accountName,账户类型:r.ownerType===0?"自营":"客户","24小时产出（BTC）":r.btcOutput24h.toFixed(8),"理论算力（E）":r.theoreticalPower.toFixed(6),"24小时算力（E）":r.power24h.toFixed(8),"24小时有效率":r.effectiveRate24h.toFixed(2)+"%",托管台数:r.totalMachines.toLocaleString(),在线数:r.onlineMachines.toLocaleString(),在线率:r.onlineRatio+"%",总故障台数:r.totalFailures.toLocaleString(),总故障率:Number(r.totalFailures)>0&&Number(r.totalMachines)>0?(Number(r.totalFailures)/Number(r.totalMachines)*100).toFixed(2)+"%":"0%","24小时故障数":r.failures24h.toLocaleString(),"24小时故障率":r.failureRate24h.toFixed(2)+"%","影响算力（E）":r.powerImpact.toFixed(8),影响占比:r.impactRatio.toFixed(2)+"%","影响产出（BTC）":r.outputImpact.toFixed(8),限电影响:r.limitImpactRate+"%",高温影响:r.highTemperatureRate+"%",限电算力:(r.theoreticalPower*1e6*r.limitImpactRate/100).toFixed(2)+"Th/s",高温算力:(r.theoreticalPower*1e6*r.highTemperatureRate/100).toFixed(2)+"Th/s",事件描述:r.events})),o=k.json_to_sheet(t),u=k.book_new(),M={fill:{fgColor:{rgb:"00BFFF"}},font:{color:{rgb:"FFFFFF"},bold:!0}},E=o["!ref"];if(E){const r=k.decode_range(E);for(let T=r.s.c;T<=r.e.c;T++){const w=k.encode_cell({r:0,c:T});o[w]&&(o[w].s=M)}}const I=[{wch:30},{wch:20},{wch:20},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:50}];o["!cols"]=I,k.book_append_sheet(u,o,"账户日报"),K(u,`账户日报_${p}.xlsx`)};return e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["账户日报",e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[" (",p||l,")"]})]}),e.jsx(oe,{className:"w-40",placeholder:"选择日期",onChange:(t,o)=>{g(o)}})]}),e.jsx(he,{data:O,loading:c})]}),e.jsxs("div",{ref:f,style:{borderRadius:"3px"},className:`mb-6 border-radius-3  rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${s?"sticky top-0 z-10":""}`,children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(re,{mode:"multiple",size:"middle",placeholder:"选择账户",style:{minWidth:"200px"},options:C,onChange:A,maxTagCount:3}),e.jsx(le,{type:"primary",icon:e.jsx(se,{}),onClick:G,className:"!rounded-button",children:"导出报表"})]}),e.jsx(ne,{columns:V,loading:c,dataSource:F,scroll:{x:1500},sticky:!0,pagination:{pageSize:q,showSizeChanger:!0,onShowSizeChange:t=>{J(t)},showQuickJumper:!0,showTotal:t=>`共 ${t} 条`},className:"custom-table"})]})]}),e.jsx("style",{children:`
        .ant-table-wrapper {
          height: 100%;
          overflow: auto;
        }

        .ant-table {
          height: 100%;
        }

        .custom-table .ant-table-thead > tr > th {
          background-color: rgba(250, 250, 252, 1);
          font-weight: 600;
        }

        /* .custom-table .ant-table-tbody > tr:hover > td {
        //   background-color: #f0f7ff;
        // }

        // .custom-table .ant-table-tbody > tr:nth-child(even) {
        //   background-color: #fafafa;
        // }*/

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})};export{je as default};
