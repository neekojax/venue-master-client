var re=Object.defineProperty,le=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var R=(n,s,o)=>s in n?re(n,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[s]=o,q=(n,s)=>{for(var o in s||(s={}))ce.call(s,o)&&R(n,o,s[o]);if(L)for(var o of L(s))ue.call(s,o)&&R(n,o,s[o]);return n},A=(n,s)=>le(n,ie(s));var B=(n,s,o)=>new Promise((h,m)=>{var r=d=>{try{p(o.next(d))}catch(_){m(_)}},y=d=>{try{p(o.throw(d))}catch(_){m(_)}},p=d=>d.done?h(d.value):Promise.resolve(d.value).then(r,y);p((o=o.apply(n,s)).next())});import{a as V,b as U,j as e}from"./index-CkhYJGrg.js";import{r as u}from"./react-BIszHAjf.js";import{F as de,a as me}from"./index-BkK42E6M.js";import{g as pe,A as he,a as ge}from"./short-link-CkPwifJL.js";import{E as ye}from"./index-B_42pH3t.js";import{u as xe}from"./useAuthRedirect-BnFA9Dph.js";import{f as _e}from"./excel-35wNsxPv.js";import{u as K}from"./hook-6wpHj6yk.js";import{F as l,q as g,I as c,z as O,U as fe,a0 as be,a1 as je,a2 as we,N as I,K as x,y as w,Q as ve,B as Se,V as ke,a3 as Ie,a4 as C}from"./antd-BQr4HBC_.js";import{u as Ce,a as Pe,b as Me,c as Te}from"./hook-BsgezwyS.js";import"./iconBase-DmfS09tz.js";import"./fetchHelper-BOSaaaFU.js";import"./xlsx-DaVhO591.js";import"./useQuery-BvFrkElV.js";import"./useMutation-MRaqxZ1z.js";import"./api-B7OkDLIW.js";import"./api-B0_ZYkhS.js";const{Option:Fe}=g,Ne=[{label:"场地",name:"venue_id",component:g},{label:"子账户",name:"pool_name",component:c},{label:"所属国家",name:"country",component:c},{label:"理论算力",name:"theoretical_hashrate",component:c},{label:"能耗比",name:"energy_ratio",component:c},{label:"基础托管费",name:"basic_hosting_fee",component:c},{label:"主链接",name:"master_link",component:c},{label:"备用链接",name:"backup_link",component:c}];function $e({initialValues:n,onFormInstanceReady:s}){const[o]=l.useForm(),{poolType:h}=V(U(["poolType"])),{data:m}=K(h);return u.useEffect(()=>{s(o)},[o,s]),e.jsx(l,{layout:"horizontal",form:o,name:"form_in_modal",initialValues:n,preserve:!1,labelAlign:"left",labelCol:{flex:"100px"},wrapperCol:{flex:10},className:"mt-4",children:Ne.map(r=>{var y;return e.jsx(l.Item,{label:r.label,name:r.name,rules:[{required:!0,message:`请输入${r.label}`}],children:r.component===g&&r.name==="venue_id"?e.jsx(g,{placeholder:`请选择 ${r.label}`,children:(y=m==null?void 0:m.data)==null?void 0:y.map(p=>e.jsxs(Fe,{value:p.id,children:[" ",p.venue_name]},p.id))}):e.jsx(c,{placeholder:`请输入${r.label}`,type:r.name==="theoretical_hashrate"||r.name==="energy_ratio"||r.name==="basic_hosting_fee"?"number":"text"})},r.name)})})}const{Option:P}=g,Ee={name:"",pool_type:"",country:"",status:0,theoretical_hashrate:0,energy_ratio:0,basic_hosting_fee:0,master_link:"",backup_link:""},z="mining-setting";function Ze(){var D;xe();const{poolType:n}=V(U(["poolType"])),[s,o]=u.useState(localStorage.getItem(`${z}_poolCategory`)||"主矿池"),{data:h,isLoading:m}=Ce(n,s),[r,y]=u.useState([]),[p,d]=u.useState([]),_=Pe(),G=Me(),H=Te(),[J,v]=u.useState(!1),[M,W]=u.useState(""),[T,S]=u.useState(!1),[f,Q]=u.useState(null),[F,X]=u.useState(0),{data:k}=K(n),[b]=l.useForm(),Y=a=>{Q(a),X(a.key),S(!0)},Z=()=>{b.validateFields().then(a=>{if(f){const t=A(q({},a),{id:f.id});$(F,t),S(!1),b.resetFields()}})},ee=()=>{S(!1)},te=({status:a})=>{let t="",i={};return a===1?(t="活跃",i={color:"green"}):a===0&&(t="暂停",i={color:"red"}),e.jsx("span",{style:i,children:t})};if(u.useEffect(()=>{if(h&&h.data){const a=h.data.map((t,i)=>({serialNumber:i+1,key:t.id,venue_id:t.venue_info.id,venue_name:t.venue_info.venue_name,pool_name:t.pool_name,country:t.country,status:t.status,pool_category:t.pool_category,theoretical_hashrate:t.theoretical_hashrate,energy_ratio:t.energy_ratio,basic_hosting_fee:t.basic_hosting_fee,link:t.link}));d(a)}T&&b.setFieldsValue(f)},[h,f,F]),u.useEffect(()=>{y([{dataIndex:"serialNumber",key:"serialNumber",width:40,render:(a,t)=>{const{link:i}=t;return i.includes("antpool")?e.jsx(de,{style:{color:"green",fontSize:16}}):i.includes("f2pool")?e.jsx(me,{style:{color:"orange",fontSize:16}}):e.jsx("span",{children:t.serialNumber})}},{title:"场地",dataIndex:"venue_name",key:"venue_name",width:200,render:a=>{const t=a==="Arct-HF01-J XP-AR-US";return e.jsx(O,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsxs("div",{style:{width:"100%",overflow:"hidden",color:t?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:t?"bold":"normal"},children:[a,t&&e.jsx(fe,{color:"red",style:{marginLeft:2},children:"补充"})]})})}},{title:"子账户",dataIndex:"pool_name",key:"pool_name",width:200,render:a=>e.jsx(O,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsx("div",{style:{width:"100%",overflow:"hidden",color:"#333",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})})},{title:"场地类型",dataIndex:"pool_category",key:"pool_category",width:75},{title:"所属国家",dataIndex:"country",key:"country",width:75},{title:"状态",dataIndex:"status",key:"status",width:75,filters:[{text:"活跃",value:1},{text:"暂停",value:0}],onFilter:(a,t)=>t.status===a,render:(a,t)=>e.jsx(te,{status:t.status})},{title:"理论算力(PH/s)",dataIndex:"theoretical_hashrate",key:"theoretical_hashrate",width:140,sorter:(a,t)=>a.theoretical_hashrate-t.theoretical_hashrate},{title:"能耗比(J/T)",dataIndex:"energy_ratio",key:"energy_ratio",width:120},{title:"基础托管费($/kwh)",dataIndex:"basic_hosting_fee",key:"basic_hosting_fee",width:150},{title:"链接",dataIndex:"link",key:"link",width:200,render:a=>e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",style:{color:"#1E90FF",fontSize:12},title:a,children:a.length>40?pe(a):a})},{title:"操作",valueType:"option1",key:"operation",width:100,render:(a,t)=>e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>Y(t),style:{marginRight:"7px"},children:e.jsx(be,{})},`edit-${t.key}`),e.jsx(je,{title:"确认删除此记录吗？",onConfirm:()=>N(t.key),okText:"是",cancelText:"否",children:e.jsx("a",{children:e.jsx(we,{style:{color:"red"}})},`delete-${t.key}`)})]})}])},[]),m)return e.jsx(I,{tip:"加载中..."});const ae=a=>B(this,null,function*(){v(!0),_.mutate(a,{onSuccess:()=>{x.success("添加成功"),v(!1)},onError:t=>{x.error(`添加失败: ${t.message}`),v(!1)}})}),N=a=>new Promise(()=>{H.mutate(a,{onSuccess:()=>{x.success("删除记录成功")},onError:t=>{x.error(`删除记录失败: ${t.message}`)}})}),$=(a,t)=>{const i={id:a,venue_id:t.venue_id,pool_name:t.pool_name,pool_type:n,country:t.country,status:t.status,pool_category:t.pool_category,theoretical_hashrate:String(t.theoretical_hashrate),energy_ratio:String(t.energy_ratio),basic_hosting_fee:String(t.basic_hosting_fee),link:t.link};return new Promise(()=>{G.mutate(i,{onSuccess:()=>{x.success("更新成功")},onError:j=>{x.error(`更新失败: ${j.message}`)}})})},oe=a=>{o(a.target.value),localStorage.setItem(`${z}_poolCategory`,a.target.value)},se=()=>{_e(E)},ne=a=>{W(a.target.value)},E=p.filter(a=>Object.values(a).some(t=>String(t).toLowerCase().includes(M.toLowerCase()))).sort((a,t)=>{const i=a.venue_name.toLowerCase(),j=t.venue_name.toLowerCase();return i<j?-1:i>j?1:0});return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("div",{className:"flex",children:e.jsx("div",{className:"mr-4",children:e.jsxs(w.Group,{className:"filterRadio",onChange:oe,value:s,children:[e.jsx(w.Button,{value:"主矿池",children:"主矿池"}),e.jsx(w.Button,{value:"备用矿池",children:"备用矿池"})]})})}),e.jsxs("div",{children:[e.jsx(c,{prefix:e.jsx(ve,{style:{color:"rgba(0, 0, 0, 0.25)"},size:18}),placeholder:"请输入搜索字段",value:M,onChange:ne,style:{width:250},className:"text-sm mr-10"}),e.jsx(he,{label:"添加矿池",initialValues:Ee,onSubmit:ae,FormComponent:$e,mode:ge.ADD}),e.jsx(Se,{icon:e.jsx(ke,{className:"exportIcon"}),size:"middle",className:"text-blue-500 exportButton",style:{marginLeft:"10px"},onClick:se,children:"导出"})]})]}),J&&e.jsx(I,{tip:"正在添加矿池...",size:"large",style:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3}}),m?e.jsx(I,{style:{marginTop:20}}):e.jsx(ye,{tableData:E,setTableData:d,columns:r,handleDelete:N,handleSave:$}),e.jsx(Ie,{title:"修改矿池",className:"editModal",closable:{"aria-label":"Custom Close Button"},open:T,onOk:Z,onCancel:ee,children:e.jsxs(l,{name:"basic",form:b,labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},autoComplete:"off",children:[e.jsx(l.Item,{label:"子账户名称",name:"pool_name",rules:[{required:!0,message:"Please input your pool pool_name!"}],children:e.jsx(c,{})}),e.jsx(l.Item,{label:"场地",name:"venue_id",rules:[{required:!0,message:"请选择场地!"}],children:e.jsx(g,{placeholder:"请选择场地",allowClear:!0,style:{width:"100%"},children:(D=k==null?void 0:k.data)==null?void 0:D.map(a=>e.jsxs(P,{value:a.id,children:[a.venue_name," "]},a.id))})}),e.jsx(l.Item,{label:"场地类型",name:"pool_category",rules:[{required:!0,message:"Please input your pool_category!"}],children:e.jsxs(g,{placeholder:"请选择场地类型",allowClear:!0,style:{backgroundColor:"white"},children:[e.jsx(P,{value:"主矿池",children:"主矿池"}),e.jsx(P,{value:"备用矿池",children:"备用矿池"})]})}),e.jsx(l.Item,{label:"所属国家",name:"country",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(c,{})}),e.jsx(l.Item,{label:"状态",name:"status",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(w.Group,{name:"radiogroup",defaultValue:1,options:[{value:0,label:"暂停"},{value:1,label:"活跃"}]})}),e.jsx(l.Item,{label:"理论算力",name:"theoretical_hashrate",rules:[{required:!0,message:"Please input your theoretical_hashrate!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(l.Item,{label:"能耗比",name:"energy_ratio",rules:[{required:!0,message:"Please input your energy_ratio!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(l.Item,{label:"基础托管费",name:"basic_hosting_fee",rules:[{required:!0,message:"Please input your basic_hosting_fee!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(l.Item,{label:"Link",name:"link",rules:[{required:!0,message:"Please input your link!"}],children:e.jsx(c,{})})]})})]})}export{Ze as default};
