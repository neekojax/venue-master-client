var L=(i,d,p)=>new Promise((a,s)=>{var m=u=>{try{l(p.next(u))}catch(g){s(g)}},n=u=>{try{l(p.throw(u))}catch(g){s(g)}},l=u=>u.done?a(u.value):Promise.resolve(u.value).then(m,n);l((p=p.apply(i,d)).next())});import{j as t,a as G,b as Q}from"./index-CkhYJGrg.js";import{r as h}from"./react-BIszHAjf.js";import{u as I,w as X}from"./xlsx-DaVhO591.js";import"./index-Cd3bGM7W.js";import{d as B}from"./install-Dn5CJfUk.js";import{j as $,k as f,h as C,bf as z,_ as K,T as y,b5 as Y,bg as Z,bh as ee,bi as te,Z as ie,q as oe,B as re,be as le,W as se,z as D,U as P}from"./antd-BQr4HBC_.js";import{a as ne}from"./api-DM25Oyp3.js";import"./install-52PPXTA7.js";import"./fetchHelper-BOSaaaFU.js";const ae=i=>{const d=h.useRef(null),{effective:p,theoretical:a}=i,s=a>0?p/a*100:0;return console.log(s),h.useEffect(()=>{const m=B(d.current),n={series:[{type:"gauge",startAngle:210,endAngle:-30,min:0,max:100,splitNumber:5,radius:"90%",center:["50%","55%"],axisLine:{lineStyle:{width:15,color:[[.6,"#ff4d4f"],[.8,"#fa8c16"],[1,"#52c41a"]]}},pointer:{width:8},detail:{valueAnimation:!0,formatter:"{value}%",fontSize:20,offsetCenter:[0,80]},data:[{value:s.toFixed(2)}]}]};return m.setOption(n),()=>{m.dispose()}},[s]),t.jsx("div",{ref:d,style:{height:200,width:"100%"}})},_=i=>{var m;const{values:d,colors:p}=i,a=d.reduce((n,l)=>n+l,0),s=d.map(n=>n/a*100);return t.jsxs("div",{style:{width:"100%"},children:[t.jsx("div",{style:{display:"flex",marginBottom:4,width:"100%"},children:d.map((n,l)=>l===2?null:t.jsx("div",{style:{width:`${s[l]}%`,fontWeight:"bold",fontSize:14,color:"#000",whiteSpace:"nowrap",textAlign:l===0?"left":l===1?"center":"right",paddingLeft:l===0?4:0,paddingRight:l===d.length-1?4:0,boxSizing:"border-box",visibility:l===3?"hidden":"visible"},title:`${s[l].toFixed(2)}%`,children:n!=0&&t.jsxs("div",{children:[n,"%"]})},l))}),t.jsx("div",{style:{display:"flex",width:"100%",height:20,borderRadius:4,overflow:"hidden"},children:s.map((n,l)=>t.jsx("div",{style:{width:`${n}%`,backgroundColor:p[l],borderTopLeftRadius:l===0?4:0,borderBottomLeftRadius:l===0?4:0,borderTopRightRadius:l===s.length-1?4:0,borderBottomRightRadius:l===s.length-1?4:0,transition:"width 0.3s ease"}},l))}),t.jsxs("div",{style:{marginTop:4,width:`${s[2]}%`,fontWeight:"bold",fontSize:14,color:"#000",textAlign:"center",marginLeft:`calc(${s.slice(0,2).reduce((n,l)=>n+l,0)}%)`,boxSizing:"border-box",whiteSpace:"nowrap",visibility:d.length===1?"hidden":"visible"},title:`${(m=s[2])==null?void 0:m.toFixed(2)}%`,children:[d[2],"%"]})]})},ce=({data:i})=>{var m,n,l,u,g,b,T,k,N;const d=h.useRef(null),p=h.useRef(null),a=i.totalFailures24h/i.totalMachines*100,s=i.totalPowerImpact/i.totalTheoreticalPower*100;return h.useEffect(()=>{if(d.current){p.current=B(d.current);const j=i.totalEstimateOnRackMachines,R=i.totalEstimateOnlineMachines,A=i.totalMachines,O={tooltip:{trigger:"item"},grid:{top:-10,bottom:0,left:0,right:0},series:[{name:"总数",type:"pie",radius:["80%","100%"],label:{show:!1,position:"center",formatter:`{b}
{c}`},data:[{value:A,name:"总数",itemStyle:{color:"#fa8c16"}}]},{name:"在架数",type:"pie",radius:["55%","75%"],label:{show:!1},data:[{value:j,name:"在架",itemStyle:{color:"#1890ff"}},{value:A-j,name:"未在架",itemStyle:{color:"transparent"}}]},{name:"在线数",type:"pie",radius:["30%","50%"],label:{show:!1},data:[{value:R,name:"在线",itemStyle:{color:"#52c41a"}},{value:j-R,name:"不在线",itemStyle:{color:"transparent"}}]}]};p.current.setOption(O);const v=()=>p.current&&p.current.resize();window.addEventListener("resize",v)}},[i]),t.jsxs($,{gutter:16,children:[t.jsx(f,{span:8,children:t.jsxs(C,{title:"机器汇总",bordered:!1,actions:[t.jsxs("span",{children:[t.jsx(z,{style:{color:"red",fontSize:16,marginRight:"10px"}}),t.jsxs("span",{children:["故障率：",(i.totalFailures24h/i.totalMachines*100).toFixed(2),"%"]})]},"setting"),t.jsxs("span",{children:[t.jsx(K,{style:{color:"green",fontSize:16,marginRight:"10px"}}),t.jsxs("span",{children:["在线率：",(m=i.totalOnlineRatio)==null?void 0:m.toFixed(2),"%"]})]},"setting")],children:[t.jsxs($,{justify:"space-between",align:"middle",children:[t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"托管台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalMachines})]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"在架台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalEstimateOnRackMachines})]}),t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"故障台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalFailures24h})]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"在线台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:((i==null?void 0:i.totalEstimateOnlineMachines)||0).toFixed(0)})]})]}),t.jsx("div",{ref:d,style:{width:"100%",height:168,marginTop:0,marginBottom:0}})]})}),t.jsx(f,{span:8,children:t.jsxs(C,{title:"算力汇总",bordered:!1,actions:[t.jsxs("span",{children:[t.jsx(Y,{style:{fontSize:16,color:"#1890ff",marginRight:"10px"}}),t.jsxs("span",{children:["算力有效率：",(n=(i==null?void 0:i.averageEffectiveRate)||0)==null?void 0:n.toFixed(2),"%"]})]},"setting")],children:[t.jsxs($,{justify:"space-between",align:"middle",children:[t.jsxs(f,{span:12,style:{textAlign:"left"},children:["有效算力：",((i==null?void 0:i.totalTheoreticalPower)*(i==null?void 0:i.averageEffectiveRate)/100).toFixed(2),"  EH/S"]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:["理论算力：",(l=i==null?void 0:i.totalTheoreticalPower)==null?void 0:l.toFixed(2),"  EH/S"]})]}),t.jsx(ae,{effective:(i==null?void 0:i.totalTheoreticalPower)*(i==null?void 0:i.averageEffectiveRate)/100,theoretical:i==null?void 0:i.totalTheoreticalPower})]})}),t.jsx(f,{span:8,children:t.jsxs(C,{title:"影响占比",children:[t.jsx("div",{style:{height:"20px"}}),t.jsx(_,{values:[Number(s==null?void 0:s.toFixed(2))],colors:["#52c41a","#ff4d4f","#faad14"]}),t.jsx("div",{style:{height:"30px"}}),t.jsx(_,{values:[Number(a==null?void 0:a.toFixed(2)),Number((u=i.totalLimitImpactRatio)==null?void 0:u.toFixed(2)),Number((g=i.totalHighTemperatureImpactRatio)==null?void 0:g.toFixed(2)),s-Number(a==null?void 0:a.toFixed(2))-Number((b=i.totalLimitImpactRatio)==null?void 0:b.toFixed(2))-Number((T=i.totalHighTemperatureImpactRatio)==null?void 0:T.toFixed(2))],colors:["#1890ff","#ff4d4f","#faad14"]}),t.jsxs("div",{style:{marginTop:25,marginBottom:-20,display:"flex",flexWrap:"wrap",borderTop:"1px solid #e8e8e8"},children:[t.jsxs($,{justify:"space-between",align:"middle",style:{padding:12},children:[t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(Z,{style:{color:"#faad14",marginRight:8}}),"影响占比：",s==null?void 0:s.toFixed(2),"%"]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(z,{style:{color:"#ff4d4f",marginRight:8}}),"总故障率：",a==null?void 0:a.toFixed(2),"%"]}),t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(ee,{style:{color:"#faad14",marginRight:8}}),"限电占比：",(k=i.totalLimitImpactRatio)==null?void 0:k.toFixed(2),"%"]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(te,{style:{color:"#ff4d4f",marginRight:8}}),"高温占比：",(N=i.totalHighTemperatureImpactRatio)==null?void 0:N.toFixed(2),"%"]})]}),t.jsx("div",{})]})]})})]})},be=()=>{const{poolType:i}=G(Q(["poolType"])),[d,p]=h.useState(!1),a=h.useRef(null),[s,m]=h.useState(!1);h.useEffect(()=>{const e=()=>{if(a.current){const o=a.current.getBoundingClientRect().top;m(o<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const n=new Date;n.setDate(n.getDate()-1);const l=n.toISOString().split("T")[0],[u,g]=h.useState(l),[b,T]=h.useState([]),k=e=>{T(e)},[N,j]=h.useState({}),[R,A]=h.useState([]),[O,v]=h.useState([]),[H,W]=h.useState([]),[U,q]=h.useState(20),J=[{title:"场地名",dataIndex:"venueName",key:"venueName",fixed:"left",width:200,render:e=>{const o=e==="Arct-HF01-J XP-AR-US"||e==="ARCT Technologies-HF02-AR-US";return t.jsx(D,{title:e,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:t.jsxs("div",{style:{width:"100%",overflow:"hidden",color:o?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:o?"bold":"normal"},children:[o&&t.jsx(P,{color:"red",style:{marginLeft:2},children:"补充"}),e]})})},sorter:(e,o)=>e.venueName.localeCompare(o.venueName),defaultSortOrder:"ascend"},{title:"账户名",dataIndex:"accountName",key:"accountName",fixed:"left",width:170,render:(e,o)=>{const x=o.ownerType===0?t.jsx(P,{color:"blue",style:{padding:"0px 2px"},children:"自营"}):t.jsx(P,{color:"green",style:{padding:"0px 2px"},children:"客户"});return t.jsxs(t.Fragment,{children:[`${e}`,"  ",x]})}},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,o)=>e.btcOutput24h-o.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,o)=>e.theoreticalPower-o.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,o)=>e.power24h-o.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.effectiveRate24h-o.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,o)=>e.totalMachines-o.totalMachines},{title:"在线数",dataIndex:"onlineMachines",key:"onlineMachines",width:100,align:"right"},{title:"在线率",dataIndex:"onlineRatio",key:"onlineRatio",width:100,align:"right",render:e=>t.jsx("span",{children:`${e}%`})},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:e=>t.jsx("span",{children:e}),sorter:(e,o)=>e.totalFailures-o.totalFailures},{title:"总故障率",dataIndex:"totalFailures",key:"totalMachines",width:100,align:"right",render:(e,o)=>{if(Number(o.totalMachines)===0)return t.jsx("span",{children:"0%"});const x=(e/o.totalMachines*100).toFixed(2);return t.jsx("span",{children:`${x}%`})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,o)=>e.failures24h-o.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,o)=>e.failureRate24h-o.failureRate24h},{title:"影响算力(E)",dataIndex:"powerImpact",key:"powerImpact",width:130,align:"right",render:e=>e.toFixed(6),sorter:(e,o)=>e.powerImpact-o.powerImpact},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.impactRatio-o.impactRatio},{title:"影响产出(BTC)",dataIndex:"outputImpact",key:"outputImpact",width:145,align:"right",render:e=>e.toFixed(8),sorter:(e,o)=>e.outputImpact-o.outputImpact},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.limitImpactRate-o.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.highTemperatureRate-o.highTemperatureRate},{title:"事件描述",dataIndex:"events",key:"events",width:400,render:e=>t.jsx(D,{title:e,children:t.jsx("div",{className:"line-clamp-2",children:e})})}];h.useEffect(()=>{p(!0),L(void 0,null,function*(){const o=Array.isArray(u)?u[0]:u;try{const x=yield ne(i,o);if(x&&x.data&&x.data.dailyReportStatistics){const M=x.data.dailyReportStatistics,E=x.data.summary,S=Object.keys(M).map(w=>{const c=M[w];return{key:w,venueName:c.venue_name,accountId:c.account_id,accountName:c.account_name,ownerType:c.owner_type,btcOutput24h:c.btcOutput24h||0,theoreticalPower:c.theoreticalPower||0,power24h:c.power24h||0,effectiveRate24h:c.effectiveRate24h||0,totalMachines:c.totalMachines||0,totalFailures:c.totalFailures||0,onlineMachines:c.onlineMachines||0,onlineRatio:c.onlineRatio||0,failures24h:c.failures24h||0,failureRate24h:c.failureRate24h||0,powerImpact:c.powerImpact||0,impactRatio:c.impactRatio||0,outputImpact:c.outputImpact||0,limitImpactRate:c.limitImpactRate||0,highTemperatureRate:c.highTemperatureRate||0,events:c.events||""}});A(S),v(S);const r=S.map(w=>({value:w.accountName,label:w.accountName})),F=Array.from(new Map(r.map(w=>[w.value,w])).values());W(F),j(E)}else console.error("API 返回的 dailyReportStatistics 无效:",x);p(!1)}catch(x){p(!1),console.error("获取日报数据失败:",x)}})},[u,i]),h.useEffect(()=>{if(b.length>0){console.log(b);const e=R.filter(o=>b.includes(o.accountName));v(e.sort((o,x)=>o.accountName.localeCompare(x.accountName)))}else v(R.sort((e,o)=>e.accountName.localeCompare(o.accountName)))},[b,R]);const V=()=>{const e=O.map(r=>({场地名:r.venueName,账户名:r.accountName,账户类型:r.ownerType===0?"自营":"客户","24小时产出（BTC）":r.btcOutput24h.toFixed(8),"理论算力（E）":r.theoreticalPower.toFixed(6),"24小时算力（E）":r.power24h.toFixed(8),"24小时有效率":r.effectiveRate24h.toFixed(2)+"%",托管台数:r.totalMachines.toLocaleString(),在线数:r.onlineMachines.toLocaleString(),在线率:r.onlineRatio+"%",总故障台数:r.totalFailures.toLocaleString(),总故障率:Number(r.totalFailures)>0&&Number(r.totalMachines)>0?(Number(r.totalFailures)/Number(r.totalMachines)*100).toFixed(2)+"%":"0%","24小时故障数":r.failures24h.toLocaleString(),"24小时故障率":r.failureRate24h.toFixed(2)+"%","影响算力（E）":r.powerImpact.toFixed(8),影响占比:r.impactRatio.toFixed(2)+"%","影响产出（BTC）":r.outputImpact.toFixed(8),限电影响:r.limitImpactRate+"%",高温影响:r.highTemperatureRate+"%",限电算力:(r.theoreticalPower*1e6*r.limitImpactRate/100).toFixed(2)+"Th/s",高温算力:(r.theoreticalPower*1e6*r.highTemperatureRate/100).toFixed(2)+"Th/s",事件描述:r.events})),o=I.json_to_sheet(e),x=I.book_new(),M={fill:{fgColor:{rgb:"00BFFF"}},font:{color:{rgb:"FFFFFF"},bold:!0}},E=o["!ref"];if(E){const r=I.decode_range(E);for(let F=r.s.c;F<=r.e.c;F++){const w=I.encode_cell({r:0,c:F});o[w]&&(o[w].s=M)}}const S=[{wch:30},{wch:20},{wch:20},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:50}];o["!cols"]=S,I.book_append_sheet(x,o,"账户日报"),X(x,`账户日报_${u}.xlsx`)};return t.jsxs("div",{className:"min-h-screen",children:[t.jsxs("div",{className:"mx-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["账户日报",t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[" (",u||l,")"]})]}),t.jsx(ie,{className:"w-40",placeholder:"选择日期",onChange:(e,o)=>{g(o)}})]}),t.jsx(ce,{data:N})]}),t.jsxs("div",{ref:a,style:{borderRadius:"3px"},className:`mb-6 border-radius-3  rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${s?"sticky top-0 z-10":""}`,children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsx(oe,{mode:"multiple",size:"middle",placeholder:"选择账户",style:{minWidth:"200px"},options:H,onChange:k,maxTagCount:3}),t.jsx(re,{type:"primary",icon:t.jsx(le,{}),onClick:V,className:"!rounded-button",children:"导出报表"})]}),t.jsx(se,{columns:J,loading:d,dataSource:O,scroll:{x:1500},sticky:!0,pagination:{pageSize:U,showSizeChanger:!0,onShowSizeChange:e=>{q(e)},showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table"})]})]}),t.jsx("style",{children:`
        .ant-table-wrapper {
          height: 100%;
          overflow: auto;
        }

        .ant-table {
          height: 100%;
        }

        .custom-table .ant-table-thead > tr > th {
          background-color: rgba(250, 250, 252, 1);
          font-weight: 600;
        }

        /* .custom-table .ant-table-tbody > tr:hover > td {
        //   background-color: #f0f7ff;
        // }

        // .custom-table .ant-table-tbody > tr:nth-child(even) {
        //   background-color: #fafafa;
        // }*/

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})};export{be as default};
