var I=(R,u,m)=>new Promise((T,p)=>{var v=o=>{try{f(m.next(o))}catch(x){p(x)}},d=o=>{try{f(m.throw(o))}catch(x){p(x)}},f=o=>o.done?T(o.value):Promise.resolve(o.value).then(v,d);f((m=m.apply(R,u)).next())});import{a as _,b as A,j as a}from"./index-JrZjfwQc.js";import{r as l}from"./react-BIszHAjf.js";import{u as b,w as L}from"./xlsx-DaVhO591.js";import{f as z}from"./api-1gs_1bi6.js";import{Z as W,p as U,B as H,be as J,W as V,z as S,U as q}from"./antd-B78Ig_h7.js";import"./fetchHelper-C0MWPoLz.js";const te=()=>{const{poolType:R}=_(A(["poolType"])),u=l.useRef(null),[m,T]=l.useState(!1);l.useEffect(()=>{const e=()=>{if(u.current){const t=u.current.getBoundingClientRect().top;T(t<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const p=new Date;p.setDate(p.getDate()-1);const v=p.toISOString().split("T")[0],[d,f]=l.useState(v),[o,x]=l.useState([]),k=e=>{x(e)},[h,P]=l.useState({}),[F,C]=l.useState([]),[N,j]=l.useState([]),[E,O]=l.useState([]),[D,M]=l.useState(20),B=[{title:"场地名",dataIndex:"siteName",key:"siteName",fixed:"left",width:250,render:e=>{const t=e==="Arct-HF01-J XP-AR-US"||e==="ARCT Technologies-HF02-AR-US";return a.jsx(S,{title:e,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:a.jsxs("div",{style:{width:"100%",overflow:"hidden",color:t?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:t?"bold":"normal"},children:[t&&a.jsx(q,{color:"red",style:{marginLeft:2},children:"补充"}),e]})})}},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,t)=>e.btcOutput24h-t.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.theoreticalPower-t.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.power24h-t.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRate24h-t.effectiveRate24h},{title:"T-2日有效率",dataIndex:"effectiveRateT2",key:"effectiveRateT2",width:130,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRateT2-t.effectiveRateT2},{title:"T-3日有效率",dataIndex:"effectiveRateT3",key:"effectiveRateT3",width:130,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRateT3-t.effectiveRateT3},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.totalMachines-t.totalMachines},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:e=>a.jsx("span",{children:e}),sorter:(e,t)=>e.totalFailures-t.totalFailures},{title:"总故障率",dataIndex:"totalFailures",key:"totalMachines",width:100,align:"right",render:(e,t)=>{const s=(e/t.totalMachines*100).toFixed(2);return a.jsx("span",{children:`${s}%`})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.failures24h-t.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,t)=>e.failureRate24h-t.failureRate24h},{title:"T-2日故障率",dataIndex:"failureRateT2",key:"failureRateT2",width:130,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,t)=>e.failureRateT2-t.failureRateT2},{title:"T-3日故障率",dataIndex:"failureRateT3",key:"failureRateT3",width:130,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,t)=>e.failureRateT3-t.failureRateT3},{title:"影响算力(E)",dataIndex:"powerImpact",key:"powerImpact",width:130,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.powerImpact-t.powerImpact},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.impactRatio-t.impactRatio},{title:"影响产出(BTC)",dataIndex:"outputImpact",key:"outputImpact",width:145,align:"right",render:e=>e.toFixed(8),sorter:(e,t)=>e.outputImpact-t.outputImpact},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.limitImpactRate-t.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.highTemperatureRate-t.highTemperatureRate},{title:"事件描述",dataIndex:"events",key:"events",width:400,render:e=>a.jsx(S,{title:e,children:a.jsx("div",{className:"line-clamp-2",children:e})})}];l.useEffect(()=>{I(void 0,null,function*(){const t=Array.isArray(d)?d[0]:d;try{const s=yield z(R,t);if(s&&s.data&&s.data.dailyReportStatistics){const y=s.data.dailyReportStatistics,c=s.data.summary,g=Object.keys(y).map(n=>{const r=y[n];return{key:n,siteId:r.venue_code,siteName:r.venue_name,btcOutput24h:r.btcOutput24h||0,theoreticalPower:r.theoreticalPower||0,power24h:r.power24h||0,effectiveRate24h:r.effectiveRate24h||0,effectiveRateT2:r.effectiveRateT2||0,effectiveRateT3:r.effectiveRateT3||0,totalMachines:r.totalMachines||0,totalFailures:r.totalFailures||0,failures24h:r.failures24h||0,failureRate24h:r.failureRate24h||0,failureRateT2:r.failureRateT2||0,failureRateT3:r.failureRateT3||0,powerImpact:r.powerImpact||0,impactRatio:r.impactRatio||0,outputImpact:r.outputImpact||0,limitImpactRate:r.limitImpactRate||0,highTemperatureRate:r.highTemperatureRate||0,events:r.events||""}});C(g),j(g);const i=g.map(n=>({value:n.siteName,label:n.siteName})),w=Array.from(new Map(i.map(n=>[n.value,n])).values());O(w),P({averageEfficiency:c.averageEffectiveRate||0,totalBtcOutput:c.totalBtcOutput||0,totalFailures24h:c.totalFailures24h||0,totalImpactOutput:c.totalImpactOutput||0,totalMachines:c.totalMachines||0,totalPower24h:c.totalPower24h||0,totalPowerImpact:c.totalPowerImpact||0,totalTheoreticalPower:c.totalTheoreticalPower||0})}else console.error("API 返回的 dailyReportStatistics 无效:",s)}catch(s){console.error("获取日报数据失败:",s)}})},[d,R]),l.useEffect(()=>{if(o.length>0){console.log(o);const e=F.filter(t=>o.includes(t.siteName));j(e.sort((t,s)=>t.siteName.localeCompare(s.siteName)))}else j(F.sort((e,t)=>e.siteName.localeCompare(t.siteName)))},[o,F]);const $=()=>{const e=N.map(i=>({场地名:i.siteName,"24小时产出（BTC）":i.btcOutput24h.toFixed(8),"理论算力（E）":i.theoreticalPower.toFixed(6),"24小时算力（E）":i.power24h.toFixed(8),"24小时有效率":i.effectiveRate24h.toFixed(2)+"%","T-2日有效率":i.effectiveRateT2.toFixed(2)+"%","T-3日有效率":i.effectiveRateT3.toFixed(2)+"%",托管台数:i.totalMachines.toLocaleString(),总故障台数:i.totalFailures.toLocaleString(),总故障率:(i.totalFailures/i.totalMachines*100).toFixed(2)+"%","24小时故障数":i.failures24h.toLocaleString(),"24小时故障率":i.failureRate24h.toFixed(2)+"%","T-2日故障率":i.failureRateT2.toFixed(2)+"%","T-3日故障率":i.failureRateT3.toFixed(2)+"%","影响算力（E）":i.powerImpact.toFixed(8),影响占比:i.impactRatio.toFixed(2)+"%","影响产出（BTC）":i.outputImpact.toFixed(8),限电影响:i.limitImpactRate+"%",高温影响:i.highTemperatureRate+"%",限电算力:(i.theoreticalPower*1e6*i.limitImpactRate/100).toFixed(2)+"Th/s",高温算力:(i.theoreticalPower*1e6*i.highTemperatureRate/100).toFixed(2)+"Th/s",事件描述:i.events})),t=b.json_to_sheet(e),s=b.book_new(),y={fill:{fgColor:{rgb:"00BFFF"}},font:{color:{rgb:"FFFFFF"},bold:!0}},c=t["!ref"];if(c){const i=b.decode_range(c);for(let w=i.s.c;w<=i.e.c;w++){const n=b.encode_cell({r:0,c:w});t[n]&&(t[n].s=y)}}const g=[{wch:30},{wch:20},{wch:20},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:50}];t["!cols"]=g,b.book_append_sheet(s,t,"运营日报"),L(s,`运营日报_${d}.xlsx`)};return a.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[a.jsxs("div",{className:"mx-auto",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["运营日报",a.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[" (",d||v,")"]})]}),a.jsx(W,{className:"w-40",placeholder:"选择日期",onChange:(e,t)=>{f(t)}})]}),a.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"平均有效率"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsxs("span",{className:"text-3xl font-bold text-blue-600",children:[" ",(h.averageEfficiency||0).toFixed(2),"%"]})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"24小时产出（BTC）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsxs("span",{className:"text-3xl font-bold text-blue-600",children:[" ",(h.totalBtcOutput||0).toFixed(4)]})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-green-50 to-green-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总理论算力（E）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-green-600",children:(h.totalTheoreticalPower||0).toFixed(2)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-green-50 to-green-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"24小时总算力（E）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-green-600",children:(h.totalPower24h||0).toFixed(2)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总影响算力（E）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-purple-600",children:(h.totalPowerImpact||0).toFixed(2)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总影响产出（BTC）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-purple-600",children:(h.totalImpactOutput||0).toFixed(4)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-amber-50 to-amber-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"托管台数"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-amber-600",children:(h.totalMachines||0).toLocaleString()})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-amber-50 to-amber-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总故障数"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-amber-600",children:(h.totalFailures24h||0).toLocaleString()})})]})]})]}),a.jsxs("div",{ref:u,className:`mb-6 rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${m?"sticky top-0 z-10":""}`,children:[a.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[a.jsx(U,{mode:"multiple",size:"middle",placeholder:"选择场地",style:{minWidth:"300px"},options:E,onChange:k,maxTagCount:3}),a.jsx(H,{type:"primary",icon:a.jsx(J,{}),onClick:$,className:"!rounded-button",children:"导出报表"})]}),a.jsx(V,{columns:B,dataSource:N,scroll:{x:1500},sticky:!0,pagination:{pageSize:D,showSizeChanger:!0,onShowSizeChange:e=>{M(e)},showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table"})]})]}),a.jsx("style",{children:`
        .ant-table-wrapper {
          height: 100%;
          overflow: auto;
        }

        .ant-table {
          height: 100%;
        }

        .custom-table .ant-table-thead > tr > th {
          background-color: #f5f5f5;
          font-weight: 600;
        }

        .custom-table .ant-table-tbody > tr:hover > td {
          background-color: #f0f7ff;
        }

        .custom-table .ant-table-tbody > tr:nth-child(even) {
          background-color: #fafafa;
        }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})};export{te as default};
