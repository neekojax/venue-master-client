var le=Object.defineProperty,re=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var q=(l,s,o)=>s in l?le(l,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[s]=o,A=(l,s)=>{for(var o in s||(s={}))ce.call(s,o)&&q(l,o,s[o]);if(R)for(var o of R(s))ue.call(s,o)&&q(l,o,s[o]);return l},B=(l,s)=>re(l,ie(s));var O=(l,s,o)=>new Promise((d,h)=>{var y=r=>{try{p(o.next(r))}catch(_){h(_)}},n=r=>{try{p(o.throw(r))}catch(_){h(_)}},p=r=>r.done?d(r.value):Promise.resolve(r.value).then(y,n);p((o=o.apply(l,s)).next())});import{a as T,b as U,j as e}from"./index-Du8lkgY8.js";import{r as m}from"./react-BIszHAjf.js";import{F as me,a as de}from"./index-BkK42E6M.js";import{g as pe,A as he,a as ye}from"./short-link-DG4CbB0J.js";import{E as ge}from"./index-CYxJUHn5.js";import{u as xe}from"./useAuthRedirect-DVeh9ShO.js";import{f as _e}from"./excel-35wNsxPv.js";import{u as K}from"./hook-DgjIS7sM.js";import{F as i,q as g,I as u,z,U as fe,a0 as be,a1 as je,a2 as we,N as I,K as x,y as w,Q as ve,B as Se,V as ke,a3 as Ie,a4 as C}from"./antd-D8kp0uix.js";import{u as Ce,a as Pe,b as Te,c as Me}from"./hook-CKuR7td7.js";import"./iconBase-DmfS09tz.js";import"./fetchHelper-BLjF9EnJ.js";import"./xlsx-DaVhO591.js";import"./useQuery-B-4S-N3E.js";import"./useMutation-Upr3j24I.js";import"./api-C46sBriV.js";import"./api-DnR2bots.js";const{Option:Fe}=g,Ne=[{label:"场地",name:"venue_id",component:g},{label:"子账户",name:"pool_name",component:u},{label:"场地主体",name:"pool_type",component:u},{label:"所属国家",name:"country",component:u},{label:"理论算力",name:"theoretical_hashrate",component:u},{label:"能耗比",name:"energy_ratio",component:u},{label:"基础托管费",name:"basic_hosting_fee",component:u},{label:"主链接",name:"master_link",component:u},{label:"备用链接",name:"backup_link",component:u}];function Ee({initialValues:l,onFormInstanceReady:s}){const[o]=i.useForm(),d=T(n=>n.poolType);m.useEffect(()=>{o.setFieldsValue({pool_type:d})},[d]);const{poolType:h}=T(U(["poolType"])),{data:y}=K(h);return m.useEffect(()=>{s(o)},[o,s]),e.jsx(i,{layout:"horizontal",form:o,name:"form_in_modal",initialValues:l,preserve:!1,labelAlign:"left",labelCol:{flex:"100px"},wrapperCol:{flex:10},className:"mt-4",children:Ne.map(n=>{var p;return e.jsx(i.Item,{label:n.label,name:n.name,rules:[{required:!0,message:`请输入${n.label}`}],children:n.component===g&&n.name==="venue_id"?e.jsx(g,{placeholder:`请选择 ${n.label}`,children:(p=y==null?void 0:y.data)==null?void 0:p.map(r=>e.jsxs(Fe,{value:r.id,children:[" ",r.venue_name]},r.id))}):e.jsx(u,{placeholder:`请输入${n.label}`,disabled:n.name==="pool_type",type:n.name==="theoretical_hashrate"||n.name==="energy_ratio"||n.name==="basic_hosting_fee"?"number":"text"})},n.name)})})}const{Option:P}=g,$e={name:"",pool_type:"",country:"",status:0,theoretical_hashrate:0,energy_ratio:0,basic_hosting_fee:0,master_link:"",backup_link:""},V="mining-setting";function Ze(){var L;xe();const{poolType:l}=T(U(["poolType"])),[s,o]=m.useState(localStorage.getItem(`${V}_poolCategory`)||"主矿池"),{data:d,isLoading:h}=Ce(l,s),[y,n]=m.useState([]),[p,r]=m.useState([]),_=Pe(),G=Te(),H=Me(),[J,v]=m.useState(!1),[M,W]=m.useState(""),[F,S]=m.useState(!1),[f,Q]=m.useState(null),[N,X]=m.useState(0),{data:k}=K(l),[b]=i.useForm(),Y=a=>{Q(a),X(a.key),S(!0)},Z=()=>{b.validateFields().then(a=>{if(f){const t=B(A({},a),{id:f.id});$(N,t),S(!1),b.resetFields()}})},ee=()=>{S(!1)},te=({status:a})=>{let t="",c={};return a===1?(t="活跃",c={color:"green"}):a===0&&(t="暂停",c={color:"red"}),e.jsx("span",{style:c,children:t})};if(m.useEffect(()=>{if(d&&d.data){const a=d.data.map((t,c)=>({serialNumber:c+1,key:t.id,venue_id:t.venue_info.id,venue_name:t.venue_info.venue_name,pool_name:t.pool_name,country:t.country,status:t.status,pool_category:t.pool_category,theoretical_hashrate:t.theoretical_hashrate,energy_ratio:t.energy_ratio,basic_hosting_fee:t.basic_hosting_fee,link:t.link}));r(a)}F&&b.setFieldsValue(f)},[d,f,N]),m.useEffect(()=>{n([{dataIndex:"serialNumber",key:"serialNumber",width:40,render:(a,t)=>{const{link:c}=t;return c.includes("antpool")?e.jsx(me,{style:{color:"green",fontSize:16}}):c.includes("f2pool")?e.jsx(de,{style:{color:"orange",fontSize:16}}):e.jsx("span",{children:t.serialNumber})}},{title:"场地",dataIndex:"venue_name",key:"venue_name",width:200,render:a=>{const t=a==="Arct-HF01-J XP-AR-US";return e.jsx(z,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsxs("div",{style:{width:"100%",overflow:"hidden",color:t?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:t?"bold":"normal"},children:[a,t&&e.jsx(fe,{color:"red",style:{marginLeft:2},children:"补充"})]})})}},{title:"子账户",dataIndex:"pool_name",key:"pool_name",width:200,render:a=>e.jsx(z,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsx("div",{style:{width:"100%",overflow:"hidden",color:"#333",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})})},{title:"场地类型",dataIndex:"pool_category",key:"pool_category",width:75},{title:"所属国家",dataIndex:"country",key:"country",width:75},{title:"状态",dataIndex:"status",key:"status",width:75,filters:[{text:"活跃",value:1},{text:"暂停",value:0}],onFilter:(a,t)=>t.status===a,render:(a,t)=>e.jsx(te,{status:t.status})},{title:"理论算力(PH/s)",dataIndex:"theoretical_hashrate",key:"theoretical_hashrate",width:140,sorter:(a,t)=>a.theoretical_hashrate-t.theoretical_hashrate},{title:"能耗比(J/T)",dataIndex:"energy_ratio",key:"energy_ratio",width:120},{title:"基础托管费($/kwh)",dataIndex:"basic_hosting_fee",key:"basic_hosting_fee",width:150},{title:"链接",dataIndex:"link",key:"link",width:200,render:a=>e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",style:{color:"#1E90FF",fontSize:12},title:a,children:a.length>40?pe(a):a})},{title:"操作",valueType:"option1",key:"operation",width:100,render:(a,t)=>e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>Y(t),style:{marginRight:"7px"},children:e.jsx(be,{})},`edit-${t.key}`),e.jsx(je,{title:"确认删除此记录吗？",onConfirm:()=>E(t.key),okText:"是",cancelText:"否",children:e.jsx("a",{children:e.jsx(we,{style:{color:"red"}})},`delete-${t.key}`)})]})}])},[]),h)return e.jsx(I,{tip:"加载中..."});const ae=a=>O(this,null,function*(){v(!0),_.mutate(a,{onSuccess:()=>{x.success("添加成功"),v(!1)},onError:t=>{x.error(`添加失败: ${t.message}`),v(!1)}})}),E=a=>new Promise(()=>{H.mutate(a,{onSuccess:()=>{x.success("删除记录成功")},onError:t=>{x.error(`删除记录失败: ${t.message}`)}})}),$=(a,t)=>{const c={id:a,venue_id:t.venue_id,pool_name:t.pool_name,pool_type:l,country:t.country,status:t.status,pool_category:t.pool_category,theoretical_hashrate:String(t.theoretical_hashrate),energy_ratio:String(t.energy_ratio),basic_hosting_fee:String(t.basic_hosting_fee),link:t.link};return new Promise(()=>{G.mutate(c,{onSuccess:()=>{x.success("更新成功")},onError:j=>{x.error(`更新失败: ${j.message}`)}})})},oe=a=>{o(a.target.value),localStorage.setItem(`${V}_poolCategory`,a.target.value)},se=()=>{_e(D)},ne=a=>{W(a.target.value)},D=p.filter(a=>Object.values(a).some(t=>String(t).toLowerCase().includes(M.toLowerCase()))).sort((a,t)=>{const c=a.venue_name.toLowerCase(),j=t.venue_name.toLowerCase();return c<j?-1:c>j?1:0});return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("div",{className:"flex",children:e.jsx("div",{className:"mr-4",children:e.jsxs(w.Group,{className:"filterRadio",onChange:oe,value:s,children:[e.jsx(w.Button,{value:"主矿池",children:"主矿池"}),e.jsx(w.Button,{value:"备用矿池",children:"备用矿池"})]})})}),e.jsxs("div",{children:[e.jsx(u,{prefix:e.jsx(ve,{style:{color:"rgba(0, 0, 0, 0.25)"},size:18}),placeholder:"请输入搜索字段",value:M,onChange:ne,style:{width:250},className:"text-sm mr-10"}),e.jsx(he,{label:"添加矿池",initialValues:$e,onSubmit:ae,FormComponent:Ee,mode:ye.ADD}),e.jsx(Se,{icon:e.jsx(ke,{className:"exportIcon"}),size:"middle",className:"text-blue-500 exportButton",style:{marginLeft:"10px"},onClick:se,children:"导出"})]})]}),J&&e.jsx(I,{tip:"正在添加矿池...",size:"large",style:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3}}),h?e.jsx(I,{style:{marginTop:20}}):e.jsx(ge,{tableData:D,setTableData:r,columns:y,handleDelete:E,handleSave:$}),e.jsx(Ie,{title:"修改矿池",className:"editModal",closable:{"aria-label":"Custom Close Button"},open:F,onOk:Z,onCancel:ee,children:e.jsxs(i,{name:"basic",form:b,labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},autoComplete:"off",children:[e.jsx(i.Item,{label:"子账户名称",name:"pool_name",rules:[{required:!0,message:"Please input your pool pool_name!"}],children:e.jsx(u,{})}),e.jsx(i.Item,{label:"场地",name:"venue_id",rules:[{required:!0,message:"请选择场地!"}],children:e.jsx(g,{placeholder:"请选择场地",allowClear:!0,style:{width:"100%"},children:(L=k==null?void 0:k.data)==null?void 0:L.map(a=>e.jsxs(P,{value:a.id,children:[a.venue_name," "]},a.id))})}),e.jsx(i.Item,{label:"场地类型",name:"pool_category",rules:[{required:!0,message:"Please input your pool_category!"}],children:e.jsxs(g,{placeholder:"请选择场地类型",allowClear:!0,style:{backgroundColor:"white"},children:[e.jsx(P,{value:"主矿池",children:"主矿池"}),e.jsx(P,{value:"备用矿池",children:"备用矿池"})]})}),e.jsx(i.Item,{label:"所属国家",name:"country",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(u,{})}),e.jsx(i.Item,{label:"状态",name:"status",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(w.Group,{name:"radiogroup",defaultValue:1,options:[{value:0,label:"暂停"},{value:1,label:"活跃"}]})}),e.jsx(i.Item,{label:"理论算力",name:"theoretical_hashrate",rules:[{required:!0,message:"Please input your theoretical_hashrate!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(i.Item,{label:"能耗比",name:"energy_ratio",rules:[{required:!0,message:"Please input your energy_ratio!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(i.Item,{label:"基础托管费",name:"basic_hosting_fee",rules:[{required:!0,message:"Please input your basic_hosting_fee!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(i.Item,{label:"Link",name:"link",rules:[{required:!0,message:"Please input your link!"}],children:e.jsx(u,{})})]})})]})}export{Ze as default};
