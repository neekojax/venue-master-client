var re=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var A=(r,s,o)=>s in r?re(r,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[s]=o,R=(r,s)=>{for(var o in s||(s={}))ue.call(s,o)&&A(r,o,s[o]);if(L)for(var o of L(s))me.call(s,o)&&A(r,o,s[o]);return r},q=(r,s)=>ie(r,ce(s));var B=(r,s,o)=>new Promise((h,p)=>{var n=l=>{try{x(o.next(l))}catch(_){p(_)}},y=l=>{try{x(o.throw(l))}catch(_){p(_)}},x=l=>l.done?h(l.value):Promise.resolve(l.value).then(n,y);x((o=o.apply(r,s)).next())});import{a as K,b as G,j as e}from"./index-BEbgNRCJ.js";import{r as m}from"./react-BIszHAjf.js";import{F as de,a as pe}from"./index-BkK42E6M.js";import{g as he,A as xe,a as ye}from"./short-link-BSYnJ1vU.js";import{E as ge}from"./index-CmMezf35.js";import{u as _e}from"./useAuthRedirect-CJWqJVeq.js";import{f as fe}from"./excel-35wNsxPv.js";import{u as U}from"./hook-CYQTTh6Z.js";import{F as i,q as d,I as u,z as O,U as be,a0 as je,a1 as we,a2 as ve,N as I,K as g,y as w,Q as Se,B as ke,V as Ie,a3 as Ce,a4 as C}from"./antd-CcxI5lPu.js";import{u as Pe,a as Ne,b as Me,c as Te}from"./hook-DCt4-0re.js";import"./iconBase-DmfS09tz.js";import"./fetchHelper-HXplszpn.js";import"./xlsx-DaVhO591.js";import"./useQuery-CrYmNpfb.js";import"./useMutation-BsxLYlvl.js";import"./api-CGWaQgYS.js";import"./api-SDiCyX_g.js";const{Option:z}=d,Fe=[{label:"场地",name:"venue_id",component:d},{label:"子账户",name:"pool_name",component:u},{label:"场地主体",name:"pool_type",component:d,options:[{value:"CANG",label:"CANG"},{value:"NS",label:"NS"},{value:"ND",label:"ND"},{value:"KZ",label:"KZ"}]},{label:"所属国家",name:"country",component:u},{label:"理论算力",name:"theoretical_hashrate",component:u},{label:"能耗比",name:"energy_ratio",component:u},{label:"基础托管费",name:"basic_hosting_fee",component:u},{label:"主链接",name:"master_link",component:u},{label:"备用链接",name:"backup_link",component:u}];function $e({initialValues:r,onFormInstanceReady:s}){const[o]=i.useForm(),{poolType:h}=K(G(["poolType"])),{data:p}=U(h);return m.useEffect(()=>{s(o)},[o,s]),e.jsx(i,{layout:"horizontal",form:o,name:"form_in_modal",initialValues:r,preserve:!1,labelAlign:"left",labelCol:{flex:"100px"},wrapperCol:{flex:10},className:"mt-4",children:Fe.map(n=>{var y,x;return e.jsx(i.Item,{label:n.label,name:n.name,rules:[{required:!0,message:`请输入${n.label}`}],children:n.component===d&&n.name==="venue_id"?e.jsx(d,{placeholder:`请选择 ${n.label}`,children:(y=p==null?void 0:p.data)==null?void 0:y.map(l=>e.jsxs(z,{value:l.id,children:[" ",l.venue_name]},l.id))}):n.component===d?e.jsx(d,{placeholder:`请选择 ${n.label}`,children:(x=n.options)==null?void 0:x.map(l=>e.jsx(z,{value:l.value,children:l.label},l.value))}):e.jsx(u,{placeholder:`请输入${n.label}`,type:n.name==="theoretical_hashrate"||n.name==="energy_ratio"||n.name==="basic_hosting_fee"?"number":"text"})},n.name)})})}const{Option:P}=d,De={name:"",pool_type:"",country:"",status:0,theoretical_hashrate:0,energy_ratio:0,basic_hosting_fee:0,master_link:"",backup_link:""},V="mining-setting";function Ye(){var E;_e();const{poolType:r}=K(G(["poolType"])),[s,o]=m.useState(localStorage.getItem(`${V}_poolCategory`)||"主矿池"),{data:h,isLoading:p}=Pe(r,s),[n,y]=m.useState([]),[x,l]=m.useState([]),_=Ne(),H=Me(),J=Te(),[W,v]=m.useState(!1),[N,Z]=m.useState(""),[M,S]=m.useState(!1),[f,Q]=m.useState(null),[T,X]=m.useState(0),{data:k}=U(r),[b]=i.useForm(),Y=a=>{Q(a),X(a.key),S(!0)},ee=()=>{b.validateFields().then(a=>{if(f){const t=q(R({},a),{id:f.id});$(T,t),S(!1),b.resetFields()}})},te=()=>{S(!1)},ae=({status:a})=>{let t="",c={};return a===1?(t="活跃",c={color:"green"}):a===0&&(t="暂停",c={color:"red"}),e.jsx("span",{style:c,children:t})};if(m.useEffect(()=>{if(h&&h.data){const a=h.data.map((t,c)=>({serialNumber:c+1,key:t.id,venue_id:t.venue_info.id,venue_name:t.venue_info.venue_name,pool_name:t.pool_name,country:t.country,status:t.status,pool_category:t.pool_category,theoretical_hashrate:t.theoretical_hashrate,energy_ratio:t.energy_ratio,basic_hosting_fee:t.basic_hosting_fee,link:t.link}));l(a)}M&&b.setFieldsValue(f)},[h,f,T]),m.useEffect(()=>{y([{dataIndex:"serialNumber",key:"serialNumber",width:40,render:(a,t)=>{const{link:c}=t;return c.includes("antpool")?e.jsx(de,{style:{color:"green",fontSize:16}}):c.includes("f2pool")?e.jsx(pe,{style:{color:"orange",fontSize:16}}):e.jsx("span",{children:t.serialNumber})}},{title:"场地",dataIndex:"venue_name",key:"venue_name",width:200,render:a=>{const t=a==="Arct-HF01-J XP-AR-US";return e.jsx(O,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsxs("div",{style:{width:"100%",overflow:"hidden",color:t?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:t?"bold":"normal"},children:[a,t&&e.jsx(be,{color:"red",style:{marginLeft:2},children:"补充"})]})})}},{title:"子账户",dataIndex:"pool_name",key:"pool_name",width:200,render:a=>e.jsx(O,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsx("div",{style:{width:"100%",overflow:"hidden",color:"#333",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a})})},{title:"场地类型",dataIndex:"pool_category",key:"pool_category",width:75},{title:"所属国家",dataIndex:"country",key:"country",width:75},{title:"状态",dataIndex:"status",key:"status",width:75,filters:[{text:"活跃",value:1},{text:"暂停",value:0}],onFilter:(a,t)=>t.status===a,render:(a,t)=>e.jsx(ae,{status:t.status})},{title:"理论算力(PH/s)",dataIndex:"theoretical_hashrate",key:"theoretical_hashrate",width:140,sorter:(a,t)=>a.theoretical_hashrate-t.theoretical_hashrate},{title:"能耗比(J/T)",dataIndex:"energy_ratio",key:"energy_ratio",width:120},{title:"基础托管费($/kwh)",dataIndex:"basic_hosting_fee",key:"basic_hosting_fee",width:150},{title:"链接",dataIndex:"link",key:"link",width:200,render:a=>e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",style:{color:"#1E90FF",fontSize:12},title:a,children:a.length>40?he(a):a})},{title:"操作",valueType:"option1",key:"operation",width:100,render:(a,t)=>e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>Y(t),style:{marginRight:"7px"},children:e.jsx(je,{})},`edit-${t.key}`),e.jsx(we,{title:"确认删除此记录吗？",onConfirm:()=>F(t.key),okText:"是",cancelText:"否",children:e.jsx("a",{children:e.jsx(ve,{style:{color:"red"}})},`delete-${t.key}`)})]})}])},[]),p)return e.jsx(I,{tip:"加载中..."});const oe=a=>B(this,null,function*(){v(!0),_.mutate(a,{onSuccess:()=>{g.success("添加成功"),v(!1)},onError:t=>{g.error(`添加失败: ${t.message}`),v(!1)}})}),F=a=>new Promise(()=>{J.mutate(a,{onSuccess:()=>{g.success("删除记录成功")},onError:t=>{g.error(`删除记录失败: ${t.message}`)}})}),$=(a,t)=>{const c={id:a,venue_id:t.venue_id,pool_name:t.pool_name,pool_type:r,country:t.country,status:t.status,pool_category:t.pool_category,theoretical_hashrate:String(t.theoretical_hashrate),energy_ratio:String(t.energy_ratio),basic_hosting_fee:String(t.basic_hosting_fee),link:t.link};return new Promise(()=>{H.mutate(c,{onSuccess:()=>{g.success("更新成功")},onError:j=>{g.error(`更新失败: ${j.message}`)}})})},se=a=>{o(a.target.value),localStorage.setItem(`${V}_poolCategory`,a.target.value)},ne=()=>{fe(D)},le=a=>{Z(a.target.value)},D=x.filter(a=>Object.values(a).some(t=>String(t).toLowerCase().includes(N.toLowerCase()))).sort((a,t)=>{const c=a.venue_name.toLowerCase(),j=t.venue_name.toLowerCase();return c<j?-1:c>j?1:0});return e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("div",{className:"flex",children:e.jsx("div",{className:"mr-4",children:e.jsxs(w.Group,{className:"filterRadio",onChange:se,value:s,children:[e.jsx(w.Button,{value:"主矿池",children:"主矿池"}),e.jsx(w.Button,{value:"备用矿池",children:"备用矿池"})]})})}),e.jsxs("div",{children:[e.jsx(u,{prefix:e.jsx(Se,{style:{color:"rgba(0, 0, 0, 0.25)"},size:18}),placeholder:"请输入搜索字段",value:N,onChange:le,style:{width:250},className:"text-sm mr-10"}),e.jsx(xe,{label:"添加矿池",initialValues:De,onSubmit:oe,FormComponent:$e,mode:ye.ADD}),e.jsx(ke,{icon:e.jsx(Ie,{className:"exportIcon"}),size:"middle",className:"text-blue-500 exportButton",style:{marginLeft:"10px"},onClick:ne,children:"导出"})]})]}),W&&e.jsx(I,{tip:"正在添加矿池...",size:"large",style:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3}}),p?e.jsx(I,{style:{marginTop:20}}):e.jsx(ge,{tableData:D,setTableData:l,columns:n,handleDelete:F,handleSave:$}),e.jsx(Ce,{title:"修改矿池",className:"editModal",closable:{"aria-label":"Custom Close Button"},open:M,onOk:ee,onCancel:te,children:e.jsxs(i,{name:"basic",form:b,labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},autoComplete:"off",children:[e.jsx(i.Item,{label:"子账户名称",name:"pool_name",rules:[{required:!0,message:"Please input your pool pool_name!"}],children:e.jsx(u,{})}),e.jsx(i.Item,{label:"场地",name:"venue_id",rules:[{required:!0,message:"请选择场地!"}],children:e.jsx(d,{placeholder:"请选择场地",allowClear:!0,style:{width:"100%"},children:(E=k==null?void 0:k.data)==null?void 0:E.map(a=>e.jsxs(P,{value:a.id,children:[a.venue_name," "]},a.id))})}),e.jsx(i.Item,{label:"场地类型",name:"pool_category",rules:[{required:!0,message:"Please input your pool_category!"}],children:e.jsxs(d,{placeholder:"请选择场地类型",allowClear:!0,style:{backgroundColor:"white"},children:[e.jsx(P,{value:"主矿池",children:"主矿池"}),e.jsx(P,{value:"备用矿池",children:"备用矿池"})]})}),e.jsx(i.Item,{label:"所属国家",name:"country",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(u,{})}),e.jsx(i.Item,{label:"状态",name:"status",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(w.Group,{name:"radiogroup",defaultValue:1,options:[{value:0,label:"暂停"},{value:1,label:"活跃"}]})}),e.jsx(i.Item,{label:"理论算力",name:"theoretical_hashrate",rules:[{required:!0,message:"Please input your theoretical_hashrate!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(i.Item,{label:"能耗比",name:"energy_ratio",rules:[{required:!0,message:"Please input your energy_ratio!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(i.Item,{label:"基础托管费",name:"basic_hosting_fee",rules:[{required:!0,message:"Please input your basic_hosting_fee!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(i.Item,{label:"Link",name:"link",rules:[{required:!0,message:"Please input your link!"}],children:e.jsx(u,{})})]})})]})}export{Ye as default};
