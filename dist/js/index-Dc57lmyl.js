var g=(o,i,a)=>new Promise((n,_)=>{var f=r=>{try{l(a.next(r))}catch(d){_(d)}},b=r=>{try{l(a.throw(r))}catch(d){_(d)}},l=r=>r.done?n(r.value):Promise.resolve(r.value).then(f,b);l((a=a.apply(o,i)).next())});import{j as s}from"./index-BdoezwgC.js";import{r as m}from"./react-BIszHAjf.js";import{F,a as D}from"./index-BkK42E6M.js";import{g as E,A,a as N}from"./short-link-mMRTF1Ot.js";import{E as T}from"./index-gVKhEhTo.js";import{u as L}from"./useAuthRedirect-BMgpnKlc.js";import{F as p,I as y,N as h,O as $,G as z,Q as M,K as u}from"./antd-BQr4HBC_.js";import{u as B,a as O,b as R,c as U}from"./hook-Br0mDhoj.js";import"./iconBase-DmfS09tz.js";import"./fetchHelper-BYcr7rCw.js";import"./useQuery-Bw5i-wSA.js";import"./useMutation-DV37tRBH.js";const q=[{label:"场地",name:"venue_name"},{label:"子账号",name:"sub_account_name"},{label:"观察者链接",name:"observer_link"},{label:"能耗比",name:"energy_ratio"},{label:"基础托管费",name:"basic_hosting_fee"}];function G({initialValues:o,onFormInstanceReady:i}){const[a]=p.useForm();return m.useEffect(()=>{i(a)},[a,i]),s.jsx(p,{layout:"horizontal",form:a,name:"form_in_modal",initialValues:o,preserve:!1,labelAlign:"left",labelCol:{flex:"100px"},wrapperCol:{flex:10},className:"mt-4",children:q.map(n=>s.jsx(p.Item,{label:n.label,name:n.name,rules:[{required:!0,message:`请输入${n.label}`}],children:s.jsx(y,{placeholder:`输入${n.label}`})},n.name))})}const J={id:0,venue_name:"",sub_account_name:"",observer_link:"",energy_ratio:"",basic_hosting_fee:""};function ne(){L();const{data:o,error:i,isLoading:a}=B(),[n,_]=m.useState([]),[f,b]=m.useState([]),[l,r]=m.useState(""),d=O(),x=R(),v=U();if(m.useEffect(()=>{if(o&&o.data){const t=o.data.map((e,c)=>({key:e.id,serialNumber:c+1,venue_name:e.venue_name,sub_account_name:e.sub_account_name,observer_link:e.observer_link,energy_ratio:e.energy_ratio,basic_hosting_fee:e.basic_hosting_fee}));b(t)}},[o]),m.useEffect(()=>{_([{dataIndex:"serialNumber",key:"serialNumber",width:40,editable:!1,render:(t,e)=>{const{observer_link:c}=e;return c.includes("antpool")?s.jsx(F,{style:{color:"green",fontSize:18}}):c.includes("f2pool")?s.jsx(D,{style:{color:"#252F4A",fontSize:18}}):s.jsx("span",{children:e.serialNumber})}},{title:"场地",dataIndex:"venue_name",key:"venue_name"},{title:"子账号",dataIndex:"sub_account_name",key:"sub_account_name"},{title:"观察者链接",dataIndex:"observer_link",key:"observer_link",width:300,render:t=>s.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",style:{color:"#252F4A"},title:t,children:t.length>40?E(t):t})},{title:"能耗比（J/T）",dataIndex:"energy_ratio",key:"energy_ratio"},{title:"基础托管费（$/kwh）",dataIndex:"basic_hosting_fee",key:"basic_hosting_fee"},{title:"操作",valueType:"option",key:"operation"}])},[]),a)return s.jsx(h,{tip:"加载中..."});if(i)return s.jsx($,{message:"错误",description:i.message,type:"error",showIcon:!0});const j=t=>{r(t.target.value)},S=t=>{x.mutate(t,{onSuccess:()=>{u.success("删除记录成功")},onError:e=>{u.error(`删除记录失败: ${e.message}`)}})},k=(t,e)=>{const c={id:t,venue_name:e.venue_name,sub_account_name:e.sub_account_name,observer_link:e.observer_link,energy_ratio:e.energy_ratio,basic_hosting_fee:e.basic_hosting_fee};d.mutate(c,{onSuccess:()=>{u.success("更新成功")},onError:C=>{u.error(`更新失败: ${C.message}`)}})},I=f.filter(t=>Object.values(t).some(e=>String(e).toLowerCase().includes(l.toLowerCase()))),w=t=>g(this,null,function*(){v.mutate(t,{onSuccess:()=>{u.success("添加成功")},onError:e=>{u.error(`添加失败: ${e.message}`)}})});return s.jsxs("div",{style:{padding:"20px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[s.jsx(z,{size:24,children:s.jsx(A,{label:"添加基础数据",initialValues:J,onSubmit:w,FormComponent:G,mode:N.ADD})}),s.jsx(y,{prefix:s.jsx(M,{style:{color:"rgba(0, 0, 0, 0.25)",fontSize:18}}),placeholder:"请输入搜索字段",value:l,onChange:j,style:{width:250},className:"text-sm mr-24"})]}),a?s.jsx(h,{style:{marginTop:20}}):s.jsx(T,{tableData:I,setTableData:b,columns:n,handleDelete:S,handleSave:k})]})}export{ne as default};
