var y=(d,h,n)=>new Promise((i,o)=>{var s=l=>{try{f(n.next(l))}catch(m){o(m)}},p=l=>{try{f(n.throw(l))}catch(m){o(m)}},f=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,p);f((n=n.apply(d,h)).next())});import{j as r}from"./index-BeETTzBE.js";import{e as b,g as k,m as B,r as c}from"./react-BIszHAjf.js";import{d as S,B as A,be as C,W as $,Z as M}from"./antd-BlFR_sXc.js";import{u as R,w as _}from"./xlsx-DaVhO591.js";import{b as L}from"./api-DPS1A9eV.js";import"./fetchHelper-CMzXq8r_.js";var F={exports:{}};(function(d,h){(function(n,i){d.exports=i()})(b,function(){return function(n,i){i.prototype.isSameOrAfter=function(o,s){return this.isSame(o,s)||this.isAfter(o,s)}}})})(F);var z=F.exports;const V=k(z);var I={exports:{}};(function(d,h){(function(n,i){d.exports=i()})(b,function(){return function(n,i){i.prototype.isSameOrBefore=function(o,s){return this.isSame(o,s)||this.isBefore(o,s)}}})})(I);var G=I.exports;const J=k(G);S.extend(V);S.extend(J);const{RangePicker:K}=M,Y=()=>{const d=B(),h=d.venueId,n=d.venueName,[i,o]=c.useState(!1),s=c.useRef(null),[p,f]=c.useState(!1),[l,m]=c.useState([]),[x,g]=c.useState([]),[j,O]=c.useState(20);c.useEffect(()=>{const e=()=>{if(s.current){const t=s.current.getBoundingClientRect().top;f(t<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const T=[{title:"日期",dataIndex:"date",key:"date",fixed:"left",width:120},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,t)=>e.btcOutput24h-t.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.theoreticalPower-t.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.power24h-t.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRate24h-t.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.totalMachines-t.totalMachines},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.totalFailures-t.totalFailures},{title:"总故障率",key:"totalFailureRate",width:120,align:"right",render:(e,t)=>{const u=t.totalMachines?(t.totalFailures/t.totalMachines*100).toFixed(2):"0.00";return r.jsxs("span",{children:[u,"%"]})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.failures24h-t.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.failureRate24h-t.failureRate24h},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.impactRatio-t.impactRatio},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.limitImpactRate-t.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.highTemperatureRate-t.highTemperatureRate}];c.useEffect(()=>{y(void 0,null,function*(){o(!0);try{const t=yield L(Number(h));if(t&&t.data){const u=t.data.map(a=>({date:a.date||"",btcOutput24h:a.btcOutput24h||0,theoreticalPower:a.theoreticalPower||0,power24h:a.power24h||0,effectiveRate24h:a.effectiveRate24h||0,totalMachines:a.totalMachines||0,totalFailures:a.totalFailures||0,failures24h:a.failures24h||0,failureRate24h:a.failureRate24h||0,impactRatio:a.impactRatio||0,limitImpactRate:a.limitImpactRate||0,highTemperatureRate:a.highTemperatureRate||0}));m(u),g(u)}else console.error("API 返回无效:",t)}catch(t){console.error("获取日报数据失败:",t)}finally{o(!1)}})},[h]);const[D,N]=c.useState(null),v=e=>{if(N(e),console.log(D,e),e){const[t,u]=e,a=l.filter(P=>{const w=S(P.date);return w.isValid()&&w.isSameOrAfter(t,"day")&&w.isSameOrBefore(u,"day")});g(a)}else g(l)},E=()=>{if(!x.length)return;const e=R.json_to_sheet(x),t=R.book_new();R.book_append_sheet(t,e,"日报数据"),_(t,"日报数据.xlsx")};return r.jsxs("div",{className:"min-h-screen",children:[r.jsx("header",{className:"mb-0",children:r.jsx("div",{className:"flex items-center gap-4 mb-3",children:r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n})})}),r.jsxs("div",{ref:s,className:`mb-6 rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${p?"sticky top-0 z-10":""}`,children:[r.jsxs("div",{className:"mb-6 flex items-center justify-between gap-4",children:[r.jsx(K,{onChange:v}),r.jsx(A,{type:"primary",icon:r.jsx(C,{}),onClick:E,className:"!rounded-button",children:"导出报表"})]}),r.jsx("div",{className:"mx-auto",children:r.jsx($,{loading:i,columns:T,dataSource:x,scroll:{x:1200},sticky:!0,pagination:{pageSize:j,showSizeChanger:!0,onShowSizeChange:(e,t)=>O(t),showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table",rowKey:"date"})})]})]})};export{Y as default};
