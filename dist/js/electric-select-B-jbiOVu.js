var u=(a,Y,s)=>new Promise((D,m)=>{var x=i=>{try{r(s.next(i))}catch(f){m(f)}},o=i=>{try{r(s.throw(i))}catch(f){m(f)}},r=i=>i.done?D(i.value):Promise.resolve(i.value).then(x,o);r((s=s.apply(a,Y)).next())});import{j as n}from"./index-Cy3mA6Hd.js";import{r as p}from"./react-BIszHAjf.js";import{d as M,N as $,y,j as P,k as j,Y as v,B as I,V as k,Z as T}from"./antd-D8kp0uix.js";import{u as L}from"./useQuery-BekyovjT.js";import{f as S,a as O}from"./fetchHelper-BXyJn6jC.js";const A=a=>u(void 0,null,function*(){return yield O(`settlement/settlementPointList/${a}`)}),X=a=>u(void 0,null,function*(){return yield S("settlement/findSettlementData",a)}),ee=a=>u(void 0,null,function*(){return yield S("settlement/findSettlementAverage",a)}),te=a=>u(void 0,null,function*(){return yield S("settlement/findSettlementDataWithPagination",a)}),ae=a=>u(void 0,null,function*(){return yield S("settlement/downloadSettlementData",a)}),B=a=>L({queryKey:["settlement-point-list",a],queryFn:()=>A(a),enabled:!!a}),h="realTime",V="t1",{RangePicker:z}=T,{SHOW_CHILD:G}=v,H={padding:50,background:"rgba(0, 0, 0, 0.05)",borderRadius:4},J=n.jsx("div",{style:H}),ne=p.forwardRef((a,Y)=>{const{selectedType:s,setSelectedType:D,handleSearch:m,onDownload:x,storagePrefix:o}=a,{data:r,error:i,isLoading:f}=B(s),[g,C]=p.useState(JSON.parse(localStorage.getItem(`${o}_selectedNames`)||"{}")),[l,w]=p.useState((()=>{const e=localStorage.getItem(`${o}_startDate`),t=localStorage.getItem(`${o}_endDate`);return e&&t?[M(e),M(t)]:[null,null]})());if(p.useImperativeHandle(Y,()=>({triggerSearch:()=>{var t,c;const e={type:s,name:g,start:((t=l[0])==null?void 0:t.format("YYYY-MM-DD"))||"",end:((c=l[1])==null?void 0:c.format("YYYY-MM-DD"))||""};m(e)}})),p.useEffect(()=>{var e,t;m({type:s,name:g,start:l&&((e=l[0])==null?void 0:e.format("YYYY-MM-DD"))||"",end:l&&((t=l[1])==null?void 0:t.format("YYYY-MM-DD"))||""})},[g,l]),f)return n.jsx($,{tip:"Loading",children:J});if(i)return n.jsx("div",{children:"Error loading data"});const _=s===h?Object.keys(r==null?void 0:r.data).map(e=>({label:e,value:e,children:r==null?void 0:r.data[e].map(t=>({label:t,value:t}))})):(r==null?void 0:r.data.map(e=>({label:e,value:e})))||[],b=e=>{const t={};e.forEach(c=>{if(s===h){const[d,F]=c;t[d]||(t[d]=[]),t[d].push(F)}else{const[d]=c;t[d]||(t[d]=[]),t[d].push(d)}}),C(t),localStorage.setItem(`${o}_selectedNames`,JSON.stringify(t))},E=e=>{if(e&&e[0]&&e[1]){const t=e[0],c=e[1];w([t,c]),localStorage.setItem(`${o}_startDate`,t.format("YYYY-MM-DD")),localStorage.setItem(`${o}_endDate`,c.format("YYYY-MM-DD"))}else w([null,null]),localStorage.setItem(`${o}_startDate`,""),localStorage.setItem(`${o}_endDate`,"")},N=e=>{D(e.target.value),C({}),localStorage.setItem(`${o}_selectedType`,e.target.value),localStorage.setItem(`${o}_selectedNames`,JSON.stringify({}))},R=()=>Object.entries(g).flatMap(([e,t])=>s===h?t.map(c=>[e,c]):t.map(c=>[c]));return n.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[n.jsx("div",{className:"mr-4",children:n.jsxs(y.Group,{onChange:N,defaultValue:s,children:[n.jsx(y.Button,{value:h,children:"实时价格"}),n.jsx(y.Button,{value:V,children:"T-1价格"})]})}),n.jsxs(P,{gutter:16,style:{width:"80%",flexGrow:1},children:[n.jsx(j,{span:6,children:n.jsx(v,{style:{width:"100%",fontSize:"14px"},options:_,onChange:b,multiple:!0,maxTagCount:"responsive",placeholder:"请选择类型（可多选）",showCheckedStrategy:G,value:R()})}),n.jsx(j,{span:6,children:n.jsx(z,{value:l,onChange:E,style:{width:"100%",fontSize:"14px"}})}),n.jsx(j,{span:3,children:n.jsx(I,{type:"primary",onClick:()=>{var e,t;return m({type:s,name:g,start:l&&((e=l[0])==null?void 0:e.format("YYYY-MM-DD"))||"",end:l&&((t=l[1])==null?void 0:t.format("YYYY-MM-DD"))||""})},style:{backgroundColor:"#40A9FF",borderColor:"#40A9FF",color:"#FFFFFF",width:"100%"},children:"搜索"})})]}),n.jsx(I,{type:"text",icon:n.jsx(k,{className:"exportIcon"}),size:"middle",className:"text-blue-500 exportButton",onClick:x,children:"导出"})]})});export{ne as E,h as P,V as a,ee as b,te as c,ae as d,X as f};
