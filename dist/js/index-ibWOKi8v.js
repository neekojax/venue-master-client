var S=(v,p,m)=>new Promise((j,u)=>{var N=l=>{try{x(m.next(l))}catch(f){u(f)}},d=l=>{try{x(m.throw(l))}catch(f){u(f)}},x=l=>l.done?j(l.value):Promise.resolve(l.value).then(N,d);x((m=m.apply(v,p)).next())});import{a as A,b as L,j as t}from"./index-BQyPqspz.js";import{r as i}from"./react-BIszHAjf.js";import{u as b,w as $}from"./xlsx-DaVhO591.js";import{a as z}from"./api-Ngvc2bfJ.js";import{Z as W,q as U,B as q,be as H,W as J,z as T,U as V}from"./antd-CcxI5lPu.js";import"./fetchHelper-Vw8p4Uhc.js";const te=()=>{const{poolType:v}=A(L(["poolType"])),p=i.useRef(null),[m,j]=i.useState(!1);i.useEffect(()=>{const e=()=>{if(p.current){const a=p.current.getBoundingClientRect().top;j(a<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const u=new Date;u.setDate(u.getDate()-1);const N=u.toISOString().split("T")[0],[d,x]=i.useState(N),[l,f]=i.useState([]),k=e=>{f(e)},[h,P]=i.useState({}),[F,O]=i.useState([]),[I,R]=i.useState([]),[C,E]=i.useState([]),[M,D]=i.useState(20),B=[{title:"场地名",dataIndex:"venueName",key:"venueName",fixed:"left",width:200,render:e=>{const a=e==="Arct-HF01-J XP-AR-US"||e==="ARCT Technologies-HF02-AR-US";return t.jsx(T,{title:e,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:t.jsxs("div",{style:{width:"100%",overflow:"hidden",color:a?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:a?"bold":"normal"},children:[a&&t.jsx(V,{color:"red",style:{marginLeft:2},children:"补充"}),e]})})},sorter:(e,a)=>e.venueName.localeCompare(a.venueName),defaultSortOrder:"ascend"},{title:"账户名",dataIndex:"accountName",key:"accountName",fixed:"left",width:120},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,a)=>e.btcOutput24h-a.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,a)=>e.theoreticalPower-a.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,a)=>e.power24h-a.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,a)=>e.effectiveRate24h-a.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,a)=>e.totalMachines-a.totalMachines},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:e=>t.jsx("span",{children:e}),sorter:(e,a)=>e.totalFailures-a.totalFailures},{title:"总故障率",dataIndex:"totalFailures",key:"totalMachines",width:100,align:"right",render:(e,a)=>{if(Number(a.totalMachines)===0)return t.jsx("span",{children:"0%"});const r=(e/a.totalMachines*100).toFixed(2);return t.jsx("span",{children:`${r}%`})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,a)=>e.failures24h-a.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,a)=>e.failureRate24h-a.failureRate24h},{title:"影响算力(E)",dataIndex:"powerImpact",key:"powerImpact",width:130,align:"right",render:e=>e.toFixed(6),sorter:(e,a)=>e.powerImpact-a.powerImpact},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,a)=>e.impactRatio-a.impactRatio},{title:"影响产出(BTC)",dataIndex:"outputImpact",key:"outputImpact",width:145,align:"right",render:e=>e.toFixed(8),sorter:(e,a)=>e.outputImpact-a.outputImpact},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,a)=>e.limitImpactRate-a.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,a)=>e.highTemperatureRate-a.highTemperatureRate},{title:"事件描述",dataIndex:"events",key:"events",width:400,render:e=>t.jsx(T,{title:e,children:t.jsx("div",{className:"line-clamp-2",children:e})})}];i.useEffect(()=>{S(void 0,null,function*(){const a=Array.isArray(d)?d[0]:d;try{const r=yield z(v,a);if(r&&r.data&&r.data.dailyReportStatistics){const y=r.data.dailyReportStatistics,c=r.data.summary,g=Object.keys(y).map(n=>{const s=y[n];return{key:n,venueName:s.venue_name,accountId:s.account_id,accountName:s.account_name,btcOutput24h:s.btcOutput24h||0,theoreticalPower:s.theoreticalPower||0,power24h:s.power24h||0,effectiveRate24h:s.effectiveRate24h||0,totalMachines:s.totalMachines||0,totalFailures:s.totalFailures||0,failures24h:s.failures24h||0,failureRate24h:s.failureRate24h||0,powerImpact:s.powerImpact||0,impactRatio:s.impactRatio||0,outputImpact:s.outputImpact||0,limitImpactRate:s.limitImpactRate||0,highTemperatureRate:s.highTemperatureRate||0,events:s.events||""}});O(g),R(g);const o=g.map(n=>({value:n.accountName,label:n.accountName})),w=Array.from(new Map(o.map(n=>[n.value,n])).values());E(w),P({averageEfficiency:c.averageEffectiveRate||0,totalBtcOutput:c.totalBtcOutput||0,totalFailures24h:c.totalFailures24h||0,totalImpactOutput:c.totalImpactOutput||0,totalMachines:c.totalMachines||0,totalPower24h:c.totalPower24h||0,totalPowerImpact:c.totalPowerImpact||0,totalTheoreticalPower:c.totalTheoreticalPower||0})}else console.error("API 返回的 dailyReportStatistics 无效:",r)}catch(r){console.error("获取日报数据失败:",r)}})},[d,v]),i.useEffect(()=>{if(l.length>0){console.log(l);const e=F.filter(a=>l.includes(a.accountName));R(e.sort((a,r)=>a.accountName.localeCompare(r.accountName)))}else R(F.sort((e,a)=>e.accountName.localeCompare(a.accountName)))},[l,F]);const _=()=>{const e=I.map(o=>({场地名:o.venueName,账户名:o.accountName,"24小时产出（BTC）":o.btcOutput24h.toFixed(8),"理论算力（E）":o.theoreticalPower.toFixed(6),"24小时算力（E）":o.power24h.toFixed(8),"24小时有效率":o.effectiveRate24h.toFixed(2)+"%",托管台数:o.totalMachines.toLocaleString(),总故障台数:o.totalFailures.toLocaleString(),总故障率:Number(o.totalFailures)>0&&Number(o.totalMachines)>0?(Number(o.totalFailures)/Number(o.totalMachines)*100).toFixed(2)+"%":"0%","24小时故障数":o.failures24h.toLocaleString(),"24小时故障率":o.failureRate24h.toFixed(2)+"%","影响算力（E）":o.powerImpact.toFixed(8),影响占比:o.impactRatio.toFixed(2)+"%","影响产出（BTC）":o.outputImpact.toFixed(8),限电影响:o.limitImpactRate+"%",高温影响:o.highTemperatureRate+"%",限电算力:(o.theoreticalPower*1e6*o.limitImpactRate/100).toFixed(2)+"Th/s",高温算力:(o.theoreticalPower*1e6*o.highTemperatureRate/100).toFixed(2)+"Th/s",事件描述:o.events})),a=b.json_to_sheet(e),r=b.book_new(),y={fill:{fgColor:{rgb:"00BFFF"}},font:{color:{rgb:"FFFFFF"},bold:!0}},c=a["!ref"];if(c){const o=b.decode_range(c);for(let w=o.s.c;w<=o.e.c;w++){const n=b.encode_cell({r:0,c:w});a[n]&&(a[n].s=y)}}const g=[{wch:30},{wch:20},{wch:20},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:50}];a["!cols"]=g,b.book_append_sheet(r,a,"运营日报"),$(r,`运营日报_${d}.xlsx`)};return t.jsxs("div",{className:"min-h-screen bg-gray-50 p-6",children:[t.jsxs("div",{className:"mx-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["运营日报",t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[" (",d||N,")"]})]}),t.jsx(W,{className:"w-40",placeholder:"选择日期",onChange:(e,a)=>{x(a)}})]}),t.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"平均有效率"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsxs("span",{className:"text-3xl font-bold text-blue-600",children:[" ",(h.averageEfficiency||0).toFixed(2),"%"]})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"24小时产出（BTC）"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsxs("span",{className:"text-3xl font-bold text-blue-600",children:[" ",(h.totalBtcOutput||0).toFixed(4)]})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-green-50 to-green-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总理论算力（E）"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsx("span",{className:"text-3xl font-bold text-green-600",children:(h.totalTheoreticalPower||0).toFixed(2)})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-green-50 to-green-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"24小时总算力（E）"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsx("span",{className:"text-3xl font-bold text-green-600",children:(h.totalPower24h||0).toFixed(2)})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总影响算力（E）"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsx("span",{className:"text-3xl font-bold text-purple-600",children:(h.totalPowerImpact||0).toFixed(2)})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总影响产出（BTC）"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsx("span",{className:"text-3xl font-bold text-purple-600",children:(h.totalImpactOutput||0).toFixed(4)})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-amber-50 to-amber-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"托管台数"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsx("span",{className:"text-3xl font-bold text-amber-600",children:(h.totalMachines||0).toLocaleString()})})]}),t.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-amber-50 to-amber-100 p-6 shadow-sm",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总故障数"}),t.jsx("div",{className:"mt-2 flex items-baseline",children:t.jsx("span",{className:"text-3xl font-bold text-amber-600",children:(h.totalFailures24h||0).toLocaleString()})})]})]})]}),t.jsxs("div",{ref:p,className:`mb-6 rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${m?"sticky top-0 z-10":""}`,children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsx(U,{mode:"multiple",size:"middle",placeholder:"选择账户",style:{minWidth:"200px"},options:C,onChange:k,maxTagCount:3}),t.jsx(q,{type:"primary",icon:t.jsx(H,{}),onClick:_,className:"!rounded-button",children:"导出报表"})]}),t.jsx(J,{columns:B,dataSource:I,scroll:{x:1500},sticky:!0,pagination:{pageSize:M,showSizeChanger:!0,onShowSizeChange:e=>{D(e)},showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table"})]})]}),t.jsx("style",{children:`
        .ant-table-wrapper {
          height: 100%;
          overflow: auto;
        }

        .ant-table {
          height: 100%;
        }

        .custom-table .ant-table-thead > tr > th {
          background-color: #f5f5f5;
          font-weight: 600;
        }

        .custom-table .ant-table-tbody > tr:hover > td {
          background-color: #f0f7ff;
        }

        .custom-table .ant-table-tbody > tr:nth-child(even) {
          background-color: #fafafa;
        }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})};export{te as default};
