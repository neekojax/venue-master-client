var b=(c,t,n)=>new Promise((m,f)=>{var h=a=>{try{u(n.next(a))}catch(l){f(l)}},g=a=>{try{u(n.throw(a))}catch(l){f(l)}},u=a=>a.done?m(a.value):Promise.resolve(a.value).then(h,g);u((n=n.apply(c,t)).next())});import{j as e,g as O}from"./index-BPd5w9dz.js";import{m as j,r as o,L as F}from"./react-BIszHAjf.js";import{g as V,a as G,b as P,c as A,d as W,e as M,h as B,i as H}from"./api-Cs88Q7MZ.js";import{bm as q,bn as K,bi as L,$ as Q,bo as U,bp as E,bq as J,br as _,bs as C,B as v,N as X,W as T,U as Y,bt as Z,bu as ee}from"./antd-BlFR_sXc.js";import{u as w,dt as N,du as R,dv as $,i as S,a as k,b as D,L as I}from"./install-C0pYAmbF.js";import"./fetchHelper-CWtxZZEr.js";const te=()=>{var s;const{venueId:c}=j(),[t,n]=o.useState(null),[m,f]=o.useState(""),g=new Date(Date.now()-864e5).toISOString().split("T")[0],u=()=>b(void 0,null,function*(){try{const r=yield V(Number(c),g);n(r.data);const{failureRate24h:x,impactRatio:p,limitImpactRate:i,highTemperatureRate:y}=r.data,z=p-x-i-y;f(z.toFixed(2))}catch(r){console.log(r)}});o.useEffect(()=>{u()},[c]);const a=[{title:"理论台数",value:(t==null?void 0:t.totalMachines)+" 台",description:"满负荷运行中",icon:e.jsx(q,{className:"text-gray-400"})},{title:"故障总台数",value:(t==null?void 0:t.totalFailures)+" 台",description:"需要检修",textColor:"text-yellow-500",icon:e.jsx(K,{className:"text-gray-400 font-12"})},{title:"理论算力",value:((s=t==null?void 0:t.theoreticalPower)==null?void 0:s.toFixed(2))+" PH/s",description:"标准水平",icon:e.jsx(L,{className:"text-gray-400 font-12"})},{title:"24 小时算力",value:(t==null?void 0:t.power24h)+" PH/s",textColor:"text-yellow-500",icon:e.jsx(Q,{className:"text-gray-400 font-12"})}],l=[{title:"故障占比",value:(t==null?void 0:t.failureRate24h.toFixed(2))+" %",description:"一般水平",icon:e.jsx(U,{className:"text-gray-400 font-12"})},{title:"高温占比",value:(t==null?void 0:t.highTemperatureRate.toFixed(2))+" %",description:"正常范围",icon:e.jsx(E,{className:"text-gray-400 font-12",style:{fontSize:"0.95rem"}})},{title:"限电占比",value:(t==null?void 0:t.limitImpactRate.toFixed(2))+" %",description:"正常范围",icon:e.jsx(L,{className:"text-gray-500 font-12"})},{title:"其他占比",value:(Number(m)<0?0:m)+" %",description:"正常范围",icon:e.jsx(J,{className:"text-gray-500 font-12"})}],d=r=>r>=90?{borderColor:"#52c41a",textColor:"text-green-600",backGround:"rgba(204, 250, 232, 0.4)",gradient:"from-green-50 to-green-100"}:r>=80?{borderColor:"#1890ff",textColor:"text-blue-600",backGround:"rgba(204, 204, 250, 0.4)",gradient:"from-blue-50 to-blue-100"}:r>=60?{borderColor:"#faad14",textColor:"text-orange-600",backGround:"rgba(250, 235, 204,0.4)",gradient:"from-orange-50 to-orange-100"}:{borderColor:"#f5222d",textColor:"text-red-600",backGround:"rgba(250, 229, 204, 0.4)",gradient:"from-red-50 to-red-100"};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 mb-4",style:{background:"#fff",borderRadius:"4px"},children:[e.jsxs("h3",{className:"text-xl font-bold mb-6 text-gray-800 pl-2",children:[e.jsx(_,{className:`mr-2 ${d((t==null?void 0:t.effectiveRate24h)||0).textColor}`}),"算力运行状态"]}),e.jsxs("div",{className:"bg-white rounded-lg grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg shadow-demo border-2 ${d((t==null?void 0:t.effectiveRate24h)||0).gradient}`,style:{borderColor:d((t==null?void 0:t.effectiveRate24h)||0).borderColor,background:d((t==null?void 0:t.effectiveRate24h)||0).backGround},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-lg font-semibold ${d((t==null?void 0:t.effectiveRate24h)||0).textColor}`,children:"算力有效率"}),e.jsx(_,{className:` text-xl ${d((t==null?void 0:t.effectiveRate24h)||0).textColor}`})]}),e.jsxs("div",{className:`text-4xl font-bold ${d((t==null?void 0:t.effectiveRate24h)||0).textColor}`,children:[t==null?void 0:t.effectiveRate24h.toFixed(2),"%"]})]}),a.map((r,x)=>e.jsxs("div",{className:"shadow-demo p-6 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:r.title}),r.icon]}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:r.value})]},x))]})]}),e.jsxs("div",{className:"bg-gray-100 rounded-xl p-4 mb-4",style:{background:"#fff",borderRadius:"4px"},children:[e.jsxs("h3",{className:"text-xl font-bold mb-6 text-gray-800 pl-2",children:[e.jsx(C,{className:"mr-2 text-red-500"}),"算力影响因素"]}),e.jsxs("div",{className:"bg-white rounded-lg grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br shadow-demo from-red-100 to-red-50 border-2 border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-lg font-semibold text-red-600",children:"算力影响"}),e.jsx(C,{className:"text-red-500 text-xl"})]}),e.jsxs("div",{className:"text-4xl font-bold text-red-500",children:[t==null?void 0:t.impactRatio.toFixed(2)," %"]})]}),l.map((r,x)=>e.jsxs("div",{className:"p-6 shadow-sm shadow-demo rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:r.title}),r.icon]}),e.jsx("div",{className:"text-2xl font-bold text-gray-800",children:r.value})]},x))]})]})]})},ae=({venueName:c})=>{const[t,n]=o.useState(!0),[m,f]=o.useState([]),[h,g]=o.useState([]),[u,a]=o.useState(!1),d=j().venueId,s=[{title:"日期",dataIndex:"date",key:"date",fixed:"left",width:120},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,render:i=>i.toFixed(8)},{title:"理论算力(E)",dataIndex:"theoreticalPower",width:120,key:"theoreticalPower",align:"right",render:i=>i.toFixed(6)},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:i=>i.toFixed(6)},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:i=>`${i.toFixed(2)}%`},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105},{title:"总故障数",dataIndex:"totalFailures",key:"totalFailures",width:120},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:i=>i.toLocaleString()},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:i=>({children:`${i.toFixed(2)}%`,props:{style:{color:i>20?"#ff4d4f":"inherit"}}})},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:i=>`${i.toFixed(2)}%`},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:i=>`${i.toFixed(2)}%`},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:i=>`${i.toFixed(2)}%`}],r=[{title:"日期",dataIndex:"log_date",key:"log_date",fixed:"left",width:120},{title:"影响时长",dataIndex:"log_date",render:(i,y)=>(i==="---valid---"&&console.log(i),y.start_time&&y.end_time?O(y.start_time,y.end_time):"---")},{title:"时间范围",dataIndex:"start_time",render:(i,y)=>`${y.start_time} - ${y.end_time}`},{title:"事件类型",dataIndex:"log_type",key:"log_type",render:i=>{const y={限电:"red",设备故障:"orange",电力:"cyan",高温:"blue",极端天气:"magenta",日常维护:"green",网络:"geekblue",其他:"default"};return e.jsx(Y,{color:y[i],children:i})}},{title:"影响台数",dataIndex:"impact_count",key:"impact_count"},{title:"影响算力",dataIndex:"impact_power_loss",key:"impact_power_loss"},{title:"事件原因",dataIndex:"event_reason",key:"event_reason"}],x=()=>b(void 0,null,function*(){a(!0);try{const i=yield G(Number(d));g(i.data),a(!1)}catch(i){console.log(i)}}),p=()=>b(void 0,null,function*(){try{const i=yield P(Number(d));f(i.data)}catch(i){console.log(i)}});return o.useEffect(()=>{x(),p()},[d]),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{type:t?"primary":"default",onClick:()=>n(!0),children:"经营日报"}),e.jsx(v,{type:t?"default":"primary",onClick:()=>n(!1),children:"异常事件"})]}),t?e.jsx(F,{to:`/report/daily-list/${d}/${c}`,children:e.jsx(v,{type:"primary",children:"查看更多日报"})}):e.jsx(F,{to:`/venue/event-log-list/${d}/${c}`,children:e.jsx(v,{type:"primary",children:"查看更多事件"})})]}),e.jsx(X,{spinning:u,children:t?e.jsx(T,{columns:s,dataSource:m,pagination:!1,scroll:{x:1500},sticky:!0,rowKey:"key"}):e.jsx(T,{columns:r,dataSource:h,pagination:!1,rowKey:"key"})})]})};w([N,R,$,S,k]);const se=()=>{const c=o.useRef(null),{venueId:t}=j(),n=o.useRef(null),[m,f]=o.useState([]),[h,g]=o.useState([]),u=()=>b(void 0,null,function*(){try{const a=yield A(Number(t));f(a.data.map(l=>l.date).reverse()),g(a.data.map(l=>l.dayMachineFailRate).reverse())}catch(a){console.log(a)}});return o.useEffect(()=>{u()},[t]),o.useEffect(()=>{if(!c.current)return;const a=D(c.current);n.current=a;const l={title:{text:"",left:"center",top:6,textStyle:{fontSize:14,fontWeight:600}},grid:{left:12,right:12,top:10,bottom:16,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:s=>s.map(r=>`${r.name||""}<br>${r.marker}故障率：${r.value.toFixed(2)}%`).join("<br/>")},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!0,formatter:s=>{const r=new Date(s);if(!isNaN(r.getTime())){const p=r.getMonth()+1,i=r.getDate();return`${p}-${i}`}const x=s.split(/[-/]/);return x.length>=3?`${x[1]}-${x[2]}`:s}},data:m},yAxis:{type:"value",splitNumber:4,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{formatter:"{value}"},splitLine:{lineStyle:{type:"dashed"}}},series:[{type:"line",smooth:!0,itemStyle:{color:"rgb(216, 70, 70)"},data:h,lineStyle:{width:2,color:"#dc2626"},areaStyle:{color:new I(0,0,0,1,[{offset:0,color:"rgba(220, 38, 38, 0.2)"},{offset:1,color:"rgba(220, 38, 38,  0)"}])}}]};a.setOption(l);const d=new ResizeObserver(()=>{var s;(s=n.current)==null||s.resize()});return d.observe(c.current),()=>{var s;d.disconnect(),(s=n.current)==null||s.dispose(),n.current=null}},[m,h]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"故障率变化曲线"})}),e.jsx("div",{ref:c,style:{width:"100%",height:320}})]})};w([N,R,$,S,k]);const re=()=>{const c=o.useRef(null),{venueId:t}=j(),n=o.useRef(null),[m,f]=o.useState([]),[h,g]=o.useState([]),u=()=>b(void 0,null,function*(){try{const a=yield W(Number(t));f(a.data.map(l=>l.date).reverse()),g(a.data.map(l=>l.highTemperatureRate).reverse())}catch(a){console.log(a)}});return o.useEffect(()=>{u()},[t]),o.useEffect(()=>{if(!c.current)return;const a=D(c.current);n.current=a;const l={title:{text:"",left:"center",top:6,textStyle:{fontSize:14,fontWeight:600}},grid:{left:12,right:12,top:10,bottom:16,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:s=>s.map(r=>`${r.name||""}<br>${r.marker}高温影响：${r.value.toFixed(2)}%`).join("<br/>")},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!0,formatter:s=>{const r=new Date(s);if(!isNaN(r.getTime())){const p=r.getMonth()+1,i=r.getDate();return`${p}-${i}`}const x=s.split(/[-/]/);return x.length>=3?`${x[1]}-${x[2]}`:s}},data:m},yAxis:{type:"value",splitNumber:4,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{formatter:"{value}"},splitLine:{lineStyle:{type:"dashed"}}},series:[{type:"line",smooth:!0,data:h,itemStyle:{color:"rgb(216, 70, 70)"},lineStyle:{width:2,color:"#ea580c"},areaStyle:{color:new I(0,0,0,1,[{offset:0,color:"rgba(234, 88, 12, 0.2)"},{offset:1,color:"rgba(234, 88, 12, 0)"}])}}]};a.setOption(l);const d=new ResizeObserver(()=>{var s;(s=n.current)==null||s.resize()});return d.observe(c.current),()=>{var s;d.disconnect(),(s=n.current)==null||s.dispose(),n.current=null}},[m,h]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"高温影响曲线"})}),e.jsx("div",{ref:c,style:{width:"100%",height:320}})]})};w([N,R,$,S,k]);const ne=()=>{const c=o.useRef(null),{venueId:t}=j(),n=o.useRef(null),[m,f]=o.useState([]),[h,g]=o.useState([]),u=()=>b(void 0,null,function*(){try{const a=yield M(Number(t));f(a.data.map(l=>l.date).reverse()),g(a.data.map(l=>l.limitImpactRate).reverse())}catch(a){console.log(a)}});return o.useEffect(()=>{u()},[t]),o.useEffect(()=>{if(!c.current)return;const a=D(c.current);n.current=a;const l={title:{text:"",left:"center",top:6,textStyle:{fontSize:14,fontWeight:600}},grid:{left:12,right:12,top:10,bottom:16,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:s=>s.map(r=>`${r.name||""}<br>${r.marker}限电影响：${r.value.toFixed(2)}%`).join("<br/>")},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!0,formatter:s=>{const r=new Date(s);if(!isNaN(r.getTime())){const p=r.getMonth()+1,i=r.getDate();return`${p}-${i}`}const x=s.split(/[-/]/);return x.length>=3?`${x[1]}-${x[2]}`:s}},data:m},yAxis:{type:"value",splitNumber:4,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{formatter:"{value}"},splitLine:{lineStyle:{type:"dashed"}}},series:[{type:"line",smooth:!0,data:h,itemStyle:{color:"#7c3aed"},lineStyle:{width:2,color:"#7c3aed"},areaStyle:{color:new I(0,0,0,1,[{offset:0,color:"rgba(124, 58, 237, 0.2)"},{offset:1,color:"rgba(124, 58, 237, 0)"}])}}]};a.setOption(l);const d=new ResizeObserver(()=>{var s;(s=n.current)==null||s.resize()});return d.observe(c.current),()=>{var s;d.disconnect(),(s=n.current)==null||s.dispose(),n.current=null}},[m,h]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"限电影响曲线"})}),e.jsx("div",{ref:c,style:{width:"100%",height:320}})]})};w([N,R,$,S,k]);const ie=()=>{const c=o.useRef(null),{venueId:t}=j(),n=o.useRef(null),[m,f]=o.useState([]),[h,g]=o.useState([]),u=()=>b(void 0,null,function*(){try{const a=yield B(Number(t));f(a.data.map(l=>l.date).reverse()),g(a.data.map(l=>l.hashEffective).reverse())}catch(a){console.log(a)}});return o.useEffect(()=>{u()},[t]),o.useEffect(()=>{if(!c.current)return;const a=D(c.current);n.current=a;const l={title:{text:"",left:"center",top:6,textStyle:{fontSize:14,fontWeight:600}},grid:{left:12,right:12,top:10,bottom:16,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:s=>s.map(r=>`${r.name||""}<br>${r.marker}算力影响：${r.value.toFixed(2)}%`).join("<br/>")},xAxis:{type:"category",boundaryGap:!1,axisTick:{show:!1},axisLine:{show:!1},axisLabel:{show:!0,formatter:s=>{const r=new Date(s);if(!isNaN(r.getTime())){const p=r.getMonth()+1,i=r.getDate();return`${p}-${i}`}const x=s.split(/[-/]/);return x.length>=3?`${x[1]}-${x[2]}`:s}},data:m},yAxis:{type:"value",splitNumber:4,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{formatter:"{value}"},splitLine:{lineStyle:{type:"dashed"}}},series:[{type:"line",smooth:!0,data:h,lineStyle:{width:2,color:"#2563eb"},areaStyle:{color:new I(0,0,0,1,[{offset:0,color:"rgba(37, 99, 235, 0.2)"},{offset:1,color:"rgba(37, 99, 235, 0)"}])}}]};a.setOption(l);const d=new ResizeObserver(()=>{var s;(s=n.current)==null||s.resize()});return d.observe(c.current),()=>{var s;d.disconnect(),(s=n.current)==null||s.dispose(),n.current=null}},[m,h]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"算力有效率变化曲线"})}),e.jsx("div",{ref:c,style:{width:"100%",height:320}})]})},he=()=>{var u;const t=j().venueId,[n,m]=o.useState(null),f=()=>b(void 0,null,function*(){try{const a=yield H(Number(t));m(a.data)}catch(a){console.log(a)}});o.useEffect(()=>{f()},[t]);const g=new Date(Date.now()-864e5).toISOString().split("T")[0];return e.jsxs("div",{className:" mx-auto  min-h-screen",children:[e.jsxs("header",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n==null?void 0:n.venue_name}),e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:e.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded-md",children:["矿工号:"," ",(u=n==null?void 0:n.sub_accounts)==null?void 0:u.map((a,l)=>e.jsxs("span",{children:[e.jsx("a",{href:a.pool_link,target:"_blank",rel:"noreferrer",children:a.pool_name}),l!==n.sub_accounts.length-1&&" "]},a.pool_id))]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"text-primary"}),e.jsx("span",{className:"text-gray-600",children:(n==null?void 0:n.address)||"--"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"text-primary"}),e.jsx("span",{className:"text-gray-600",children:g})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"text-primary"}),e.jsx("span",{className:"text-gray-600",children:"当前温度: --"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"text-primary"}),e.jsx("span",{className:"text-gray-600",children:"当前湿度: --"})]})]})]})]}),e.jsx(te,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:e.jsx(ie,{})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:e.jsx(se,{})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:e.jsx(re,{})}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:e.jsx(ne,{})})]}),e.jsx(ae,{venueName:(n==null?void 0:n.venue_name)||""})]})};export{he as default};
