var x=(w,c,i)=>new Promise((u,d)=>{var l=r=>{try{n(i.next(r))}catch(h){d(h)}},p=r=>{try{n(i.throw(r))}catch(h){d(h)}},n=r=>r.done?u(r.value):Promise.resolve(r.value).then(l,p);n((i=i.apply(w,c)).next())});import{j as o}from"./index-DL5OjzhM.js";import{m as g,r as s}from"./react-BIszHAjf.js";import{u as f,w as b}from"./xlsx-DaVhO591.js";import{b as y}from"./api-GBlGYeVz.js";import{B as I,be as k,W as F}from"./antd-BlFR_sXc.js";import"./fetchHelper-CULhQwJj.js";const N=()=>{const c=g().venueId,i=s.useRef(null),[u,d]=s.useState(!1),[l,p]=s.useState([]),[n,r]=s.useState(20);s.useEffect(()=>{const t=()=>{if(i.current){const e=i.current.getBoundingClientRect().top;d(e<=0)}};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const h=[{title:"日期",dataIndex:"date",key:"date",fixed:"left",width:120},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:t=>t.toFixed(8),sorter:(t,e)=>t.btcOutput24h-e.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:t=>t.toFixed(6),sorter:(t,e)=>t.theoreticalPower-e.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:t=>t.toFixed(6),sorter:(t,e)=>t.power24h-e.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:t=>`${t.toFixed(2)}%`,sorter:(t,e)=>t.effectiveRate24h-e.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:t=>t.toLocaleString(),sorter:(t,e)=>t.totalMachines-e.totalMachines},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:t=>t.toLocaleString(),sorter:(t,e)=>t.totalFailures-e.totalFailures},{title:"总故障率",key:"totalFailureRate",width:120,align:"right",render:(t,e)=>{const m=e.totalMachines?(e.totalFailures/e.totalMachines*100).toFixed(2):"0.00";return o.jsxs("span",{children:[m,"%"]})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:t=>t.toLocaleString(),sorter:(t,e)=>t.failures24h-e.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:t=>`${t.toFixed(2)}%`,sorter:(t,e)=>t.failureRate24h-e.failureRate24h},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:t=>`${t.toFixed(2)}%`,sorter:(t,e)=>t.impactRatio-e.impactRatio},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,render:t=>`${t.toFixed(2)}%`,sorter:(t,e)=>t.limitImpactRate-e.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,render:t=>`${t.toFixed(2)}%`,sorter:(t,e)=>t.highTemperatureRate-e.highTemperatureRate}];s.useEffect(()=>{x(void 0,null,function*(){try{const e=yield y(Number(c));if(e&&e.data){const m=e.data.map(a=>({date:a.date||"",btcOutput24h:a.btcOutput24h||0,theoreticalPower:a.theoreticalPower||0,power24h:a.power24h||0,effectiveRate24h:a.effectiveRate24h||0,totalMachines:a.totalMachines||0,totalFailures:a.totalFailures||0,failures24h:a.failures24h||0,failureRate24h:a.failureRate24h||0,impactRatio:a.impactRatio||0,limitImpactRate:a.limitImpactRate||0,highTemperatureRate:a.highTemperatureRate||0}));p(m)}else console.error("API 返回无效:",e)}catch(e){console.error("获取日报数据失败:",e)}})},[c]);const R=()=>{if(!l.length)return;const t=f.json_to_sheet(l),e=f.book_new();f.book_append_sheet(e,t,"日报数据"),b(e,"日报数据.xlsx")};return o.jsx("div",{className:"min-h-screen",children:o.jsx("div",{className:"mx-auto",children:o.jsxs("div",{ref:i,className:`mb-6 rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${u?"sticky top-0 z-10":""}`,children:[o.jsx("div",{className:"mb-6 flex items-center justify-between gap-4",children:o.jsx(I,{type:"primary",icon:o.jsx(k,{}),onClick:R,className:"!rounded-button",children:"导出报表"})}),o.jsx(F,{columns:h,dataSource:l,scroll:{x:1200},sticky:!0,pagination:{pageSize:n,showSizeChanger:!0,onShowSizeChange:(t,e)=>r(e),showQuickJumper:!0,showTotal:t=>`共 ${t} 条`},className:"custom-table",rowKey:"date"})]})})})};export{N as default};
