var R=Object.defineProperty,S=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var I=(i,a,t)=>a in i?R(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t,v=(i,a)=>{for(var t in a||(a={}))q.call(a,t)&&I(i,t,a[t]);if(b)for(var t of b(a))E.call(a,t)&&I(i,t,a[t]);return i},M=(i,a)=>S(i,T(a));var y=(i,a,t)=>new Promise((r,u)=>{var h=n=>{try{c(t.next(n))}catch(o){u(o)}},p=n=>{try{c(t.throw(n))}catch(o){u(o)}},c=n=>n.done?r(n.value):Promise.resolve(n.value).then(h,p);c((t=t.apply(i,a)).next())});import{j as s}from"./index-D_6r9k1W.js";import{m as H,r as f}from"./react-BIszHAjf.js";import{F as m,B as O,W as A,a3 as L,Z as w,I as k,d as _,K as j,a1 as B}from"./antd-Cncqk0Hi.js";import{e as K,f as V,g as z,h as U}from"./hook-BTtDuqit.js";import"./useQuery-B8eGLB-x.js";import"./useMutation-CGhdOlCh.js";import"./api-BASYonwV.js";import"./fetchHelper-CgwgChB1.js";const ae=()=>{const i=H(),a=i.venueId,t=i.poolId,{data:r,isLoading:u}=K(t),h=V(),p=z(),c=U(),[n,o]=f.useState(!1),[x,g]=f.useState(null),[l]=m.useForm(),N=f.useMemo(()=>{var e;return(e=r==null?void 0:r.data)!=null?e:[]},[r]),F=()=>{g(null),o(!0),l.resetFields(),l.setFieldsValue({venue_id:Number(a),pool_id:Number(t)})},P=e=>{g(e),o(!0),l.setFieldsValue({id:e.id,venue_id:e.venue_id,pool_id:e.pool_id,start_time:_(e.start_time),end_time:_(e.end_time),theoretical_hashrate:e.theoretical_hashrate,hosted_machine:e.hosted_machine})},D=()=>y(void 0,null,function*(){const e=yield l.validateFields(),d={venue_id:Number(a),pool_id:Number(t),hosted_machine:Number(e.hosted_machine),theoretical_hashrate:Number(e.theoretical_hashrate),start_time:typeof e.start_time=="string"?e.start_time:_(e.start_time).format("YYYY-MM-DD HH:mm:ss"),end_time:typeof e.end_time=="string"?e.end_time:_(e.end_time).format("YYYY-MM-DD HH:mm:ss")};try{x?(yield p.mutateAsync(M(v({},d),{id:x.id})),j.success("已更新")):(yield h.mutateAsync(d),j.success("已新增")),o(!1),l.resetFields()}catch(W){}}),Y=e=>y(void 0,null,function*(){try{yield c.mutateAsync(e.id),j.success("已删除")}catch(d){}}),C=[{title:"开始时间",dataIndex:"start_time",key:"start_time"},{title:"结束时间",dataIndex:"end_time",key:"end_time"},{title:"理论算力",dataIndex:"theoretical_hashrate",key:"theoretical_hashrate"},{title:"托管机器",dataIndex:"hosted_machine",key:"hosted_machine",align:"right"},{title:"操作",key:"action",width:160,render:(e,d)=>s.jsxs("div",{className:"flex gap-3",children:[s.jsx("a",{onClick:()=>P(d),children:"修改"}),s.jsx(B,{title:"确认删除该记录？",onConfirm:()=>Y(d),okText:"删除",cancelText:"取消",children:s.jsx("a",{children:"删除"})})]})}];return s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-lg font-semibold",children:["操作记录（venueId: ",a,", poolId: ",t,"）"]}),s.jsx(O,{type:"primary",onClick:F,children:"新增记录"})]}),s.jsx(A,{rowKey:"id",loading:u,columns:C,dataSource:N,pagination:{pageSize:20}}),s.jsx(L,{title:x?"编辑记录":"新增记录",open:n,onOk:D,onCancel:()=>o(!1),confirmLoading:h.isPending||p.isPending,destroyOnClose:!0,children:s.jsxs(m,{form:l,layout:"vertical",preserve:!1,children:[s.jsx(m.Item,{label:"开始时间",name:"start_time",rules:[{required:!0,message:"请选择开始时间"}],children:s.jsx(w,{showTime:!0,style:{width:"100%"}})}),s.jsx(m.Item,{label:"结束时间",name:"end_time",rules:[{required:!0,message:"请选择结束时间"}],children:s.jsx(w,{showTime:!0,style:{width:"100%"}})}),s.jsx(m.Item,{label:"理论算力",name:"theoretical_hashrate",rules:[{required:!0,message:"请输入理论算力"}],children:s.jsx(k,{type:"number",placeholder:"请输入理论算力"})}),s.jsx(m.Item,{label:"托管机器",name:"hosted_machine",rules:[{required:!0,message:"请输入托管机器"}],children:s.jsx(k,{type:"number",placeholder:"请输入托管机器"})})]})})]})};export{ae as default};
