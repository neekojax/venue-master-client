var V=Object.defineProperty,q=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var C=(c,l,n)=>l in c?V(c,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[l]=n,O=(c,l)=>{for(var n in l||(l={}))K.call(l,n)&&C(c,n,l[n]);if(P)for(var n of P(l))Q.call(l,n)&&C(c,n,l[n]);return c},M=(c,l)=>q(c,J(l));var S=(c,l,n)=>new Promise((F,R)=>{var y=d=>{try{f(n.next(d))}catch(w){R(w)}},g=d=>{try{f(n.throw(d))}catch(w){R(w)}},f=d=>d.done?F(d.value):Promise.resolve(d.value).then(y,g);f((n=n.apply(c,l)).next())});import{a as X,b as Z,j as a}from"./index-B-9wpXJx.js";import{r as h,L as G}from"./react-BIszHAjf.js";import{u as v,w as Y}from"./xlsx-DaVhO591.js";import{f as ee,u as te}from"./api-DbEwXWrp.js";import{Z as ae,q as se,B as ie,be as re,W as oe,z as D,U as le,I as ne,K as ce}from"./antd-BlFR_sXc.js";import"./fetchHelper-4p_Wj_6l.js";const ge=()=>{const{poolType:c}=X(Z(["poolType"])),l=h.useRef(null),[n,F]=h.useState(!1),[R,y]=h.useState(null);h.useEffect(()=>{const e=()=>{if(l.current){const t=l.current.getBoundingClientRect().top;F(t<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const g=new Date;g.setDate(g.getDate()-1);const f=g.toISOString().split("T")[0],[d,w]=h.useState(f),[T,B]=h.useState([]),_=e=>{B(e)},[p,$]=h.useState({}),[j,k]=h.useState([]),[E,N]=h.useState([]),[L,A]=h.useState([]),[z,W]=h.useState(20),I=(e,t)=>S(void 0,null,function*(){try{const i=d||f,x={venue_name:e.siteName,total_failures:Number(t)},r=yield te(c,i,x);r!=null&&r.data&&(ce.success("更新成功"),k(u=>u.map(s=>s.key===e.key?M(O({},s),{totalFailures:Number(t)}):s)))}catch(i){console.log("Save failed:",i)}}),H=[{title:"场地名",dataIndex:"siteName",key:"siteName",fixed:"left",width:250,render:(e,t)=>{const i=e==="Arct-HF01-J XP-AR-US"||e==="ARCT Technologies-HF02-AR-US";return a.jsx(D,{title:e,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:a.jsxs("div",{style:{width:"100%",overflow:"hidden",color:i?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:i?"bold":"normal"},children:[i&&a.jsx(le,{color:"red",style:{marginLeft:2},children:"补充"}),a.jsx(G,{to:`/venue/detail/${t.key}`,className:"text-blue-500 hover:underline",children:e})]})})}},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,t)=>e.btcOutput24h-t.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.theoreticalPower-t.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.power24h-t.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRate24h-t.effectiveRate24h},{title:"T-2日有效率",dataIndex:"effectiveRateT2",key:"effectiveRateT2",width:130,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRateT2-t.effectiveRateT2},{title:"T-3日有效率",dataIndex:"effectiveRateT3",key:"effectiveRateT3",width:130,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRateT3-t.effectiveRateT3},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.totalMachines-t.totalMachines},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:(e,t)=>localStorage.getItem("user")!="admin"?a.jsx("span",{children:e}):R===t.key?a.jsx(ne,{size:"small",style:{padding:"0 5px",margin:0,height:"22px"},onChange:r=>I(t,r.target.value),onPressEnter:r=>I(t,r.currentTarget.value||""),onBlur:r=>{var u;return I(t,((u=r.target)==null?void 0:u.value)||"")},defaultValue:e}):a.jsx("span",{children:e}),onCell:e=>({onMouseEnter:()=>y(e.key),onMouseLeave:()=>y(null)}),sorter:(e,t)=>e.totalFailures-t.totalFailures},{title:"总故障率",dataIndex:"totalFailures",key:"totalMachines",width:100,align:"right",render:(e,t)=>{const i=(e/t.totalMachines*100).toFixed(2);return a.jsx("span",{children:`${i}%`})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.failures24h-t.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,t)=>e.failureRate24h-t.failureRate24h},{title:"T-2日故障率",dataIndex:"failureRateT2",key:"failureRateT2",width:130,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,t)=>e.failureRateT2-t.failureRateT2},{title:"T-3日故障率",dataIndex:"failureRateT3",key:"failureRateT3",width:130,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,t)=>e.failureRateT3-t.failureRateT3},{title:"影响算力(E)",dataIndex:"powerImpact",key:"powerImpact",width:130,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.powerImpact-t.powerImpact},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.impactRatio-t.impactRatio},{title:"影响产出(BTC)",dataIndex:"outputImpact",key:"outputImpact",width:145,align:"right",render:e=>e.toFixed(8),sorter:(e,t)=>e.outputImpact-t.outputImpact},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.limitImpactRate-t.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.highTemperatureRate-t.highTemperatureRate},{title:"事件描述",dataIndex:"events",key:"events",width:400,render:e=>a.jsx(D,{title:e,children:a.jsx("div",{className:"line-clamp-2",children:e})})}];h.useEffect(()=>{S(void 0,null,function*(){const t=Array.isArray(d)?d[0]:d;try{const i=yield ee(c,t);if(i&&i.data&&i.data.dailyReportStatistics){const x=i.data.dailyReportStatistics,r=i.data.summary,u=Object.keys(x).map(m=>{const o=x[m];return{key:m,siteId:o.venue_code,siteName:o.venue_name,btcOutput24h:o.btcOutput24h||0,theoreticalPower:o.theoreticalPower||0,power24h:o.power24h||0,effectiveRate24h:o.effectiveRate24h||0,effectiveRateT2:o.effectiveRateT2||0,effectiveRateT3:o.effectiveRateT3||0,totalMachines:o.totalMachines||0,totalFailures:o.totalFailures||0,failures24h:o.failures24h||0,failureRate24h:o.failureRate24h||0,failureRateT2:o.failureRateT2||0,failureRateT3:o.failureRateT3||0,powerImpact:o.powerImpact||0,impactRatio:o.impactRatio||0,outputImpact:o.outputImpact||0,limitImpactRate:o.limitImpactRate||0,highTemperatureRate:o.highTemperatureRate||0,events:o.events||""}});k(u),N(u);const s=u.map(m=>({value:m.siteName,label:m.siteName})),b=Array.from(new Map(s.map(m=>[m.value,m])).values());A(b),$({averageEfficiency:r.averageEffectiveRate||0,totalBtcOutput:r.totalBtcOutput||0,totalFailures24h:r.totalFailures24h||0,totalImpactOutput:r.totalImpactOutput||0,totalMachines:r.totalMachines||0,totalPower24h:r.totalPower24h||0,totalPowerImpact:r.totalPowerImpact||0,totalTheoreticalPower:r.totalTheoreticalPower||0})}else console.error("API 返回的 dailyReportStatistics 无效:",i)}catch(i){console.error("获取日报数据失败:",i)}})},[d,c]),h.useEffect(()=>{if(T.length>0){console.log(T);const e=j.filter(t=>T.includes(t.siteName));N(e.sort((t,i)=>t.siteName.localeCompare(i.siteName)))}else N(j.sort((e,t)=>e.siteName.localeCompare(t.siteName)))},[T,j]);const U=()=>{const e=E.map(s=>({场地名:s.siteName,"24小时产出（BTC）":s.btcOutput24h.toFixed(8),"理论算力（E）":s.theoreticalPower.toFixed(6),"24小时算力（E）":s.power24h.toFixed(8),"24小时有效率":s.effectiveRate24h.toFixed(2)+"%","T-2日有效率":s.effectiveRateT2.toFixed(2)+"%","T-3日有效率":s.effectiveRateT3.toFixed(2)+"%",托管台数:s.totalMachines.toLocaleString(),总故障台数:s.totalFailures.toLocaleString(),总故障率:(s.totalFailures/s.totalMachines*100).toFixed(2)+"%","24小时故障数":s.failures24h.toLocaleString(),"24小时故障率":s.failureRate24h.toFixed(2)+"%","T-2日故障率":s.failureRateT2.toFixed(2)+"%","T-3日故障率":s.failureRateT3.toFixed(2)+"%","影响算力（E）":s.powerImpact.toFixed(8),影响占比:s.impactRatio.toFixed(2)+"%","影响产出（BTC）":s.outputImpact.toFixed(8),限电影响:s.limitImpactRate+"%",高温影响:s.highTemperatureRate+"%",限电算力:(s.theoreticalPower*1e6*s.limitImpactRate/100).toFixed(2)+"Th/s",高温算力:(s.theoreticalPower*1e6*s.highTemperatureRate/100).toFixed(2)+"Th/s",事件描述:s.events})),t=v.json_to_sheet(e),i=v.book_new(),x={fill:{fgColor:{rgb:"00BFFF"}},font:{color:{rgb:"FFFFFF"},bold:!0}},r=t["!ref"];if(r){const s=v.decode_range(r);for(let b=s.s.c;b<=s.e.c;b++){const m=v.encode_cell({r:0,c:b});t[m]&&(t[m].s=x)}}const u=[{wch:30},{wch:20},{wch:20},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:50}];t["!cols"]=u,v.book_append_sheet(i,t,"运营日报"),Y(i,`运营日报_${d}.xlsx`)};return a.jsxs("div",{className:"min-h-screen",children:[a.jsxs("div",{className:"mx-auto",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["运营日报",a.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[" (",d||f,")"]})]}),a.jsx(ae,{className:"w-40",placeholder:"选择日期",onChange:(e,t)=>{w(t)}})]}),a.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-4",children:[a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"平均有效率"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsxs("span",{className:"text-3xl font-bold text-blue-600",children:[" ",(p.averageEfficiency||0).toFixed(2),"%"]})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-blue-50 to-blue-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"24小时产出（BTC）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsxs("span",{className:"text-3xl font-bold text-blue-600",children:[" ",(p.totalBtcOutput||0).toFixed(4)]})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-green-50 to-green-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总理论算力（E）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-green-600",children:(p.totalTheoreticalPower||0).toFixed(2)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-green-50 to-green-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"24小时总算力（E）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-green-600",children:(p.totalPower24h||0).toFixed(2)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总影响算力（E）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-purple-600",children:(p.totalPowerImpact||0).toFixed(2)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-purple-50 to-purple-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总影响产出（BTC）"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-purple-600",children:(p.totalImpactOutput||0).toFixed(4)})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-amber-50 to-amber-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"托管台数"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-amber-600",children:(p.totalMachines||0).toLocaleString()})})]}),a.jsxs("div",{className:"rounded-lg bg-gradient-to-br from-amber-50 to-amber-100 p-6 shadow-sm",children:[a.jsx("div",{className:"text-sm font-medium text-gray-500",children:"总故障数"}),a.jsx("div",{className:"mt-2 flex items-baseline",children:a.jsx("span",{className:"text-3xl font-bold text-amber-600",children:(p.totalFailures24h||0).toLocaleString()})})]})]})]}),a.jsxs("div",{ref:l,className:`mb-6 rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${n?"sticky top-0 z-10":""}`,children:[a.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[a.jsx(se,{mode:"multiple",size:"middle",placeholder:"选择场地",style:{minWidth:"300px"},options:L,onChange:_,maxTagCount:3}),a.jsx(ie,{type:"primary",icon:a.jsx(re,{}),onClick:U,className:"!rounded-button",children:"导出报表"})]}),a.jsx(oe,{columns:H,dataSource:E,scroll:{x:1500},sticky:!0,pagination:{pageSize:z,showSizeChanger:!0,onShowSizeChange:e=>{W(e)},showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table"})]})]}),a.jsx("style",{children:`
        .ant-table-wrapper {
          height: 100%;
          overflow: auto;
        }

        .ant-table {
          height: 100%;
        }

        .custom-table .ant-table-thead > tr > th {
          background-color: rgba(250, 250, 252, 1);
          font-weight: 600;
        }

        // .custom-table .ant-table-tbody > tr:hover > td {
        //   background-color: #f0f7ff;
        // }

        // .custom-table .ant-table-tbody > tr:nth-child(even) {
        //   background-color: #fafafa;
        // }

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})};export{ge as default};
