var f=(p,u,n)=>new Promise((c,i)=>{var m=s=>{try{l(n.next(s))}catch(o){i(o)}},g=s=>{try{l(n.throw(s))}catch(o){i(o)}},l=s=>s.done?c(s.value):Promise.resolve(s.value).then(m,g);l((n=n.apply(p,u)).next())});import{j as t}from"./index-Du8lkgY8.js";import{r as a}from"./react-BIszHAjf.js";import{d as D}from"./excel-35wNsxPv.js";import{P as k,E as M,c as N,d as W}from"./electric-select-CV8TRn2W.js";import{y as $,N as q,W as A,X as B,K}from"./antd-D8kp0uix.js";import"./xlsx-DaVhO591.js";import"./useQuery-B-4S-N3E.js";import"./fetchHelper-BLjF9EnJ.js";const d="electric-basic";function Y(){const[p,u]=a.useState(localStorage.getItem(`${d}_selectedType`)||k),[n,c]=a.useState(1),[i,m]=a.useState(20),[g,l]=a.useState(0),[s,o]=a.useState(()=>localStorage.getItem(`${d}_priceType`)||"all"),[P,j]=a.useState([]),[y,E]=a.useState([]),h=a.useRef(null),[w,I]=a.useState(!0),[S,v]=a.useState(null),[C,x]=a.useState(!1);a.useEffect(()=>{j([{title:"电力接入点",dataIndex:"name",key:"name",width:300},{title:"数据口径",dataIndex:"type",key:"type",width:200},{title:"限电时间范围",dataIndex:"time",key:"time"},{title:"电力价格",dataIndex:"price",key:"price",width:300,render:e=>t.jsxs("span",{children:[e," ",t.jsx("span",{style:{fontSize:"em"},children:" US$ Cent/KWH "})]})}])},[]);const b=e=>f(this,null,function*(){x(!0);try{const r={type:e.type,name:e.name,start:e.start,end:e.end,price:s,page:n,page_size:i};v(r);const T=yield N(r);E(T.data.data||[]),l(T.data.total)}catch(r){x(!1),console.error("Error fetching settlement data:",r)}finally{x(!1)}}),z=()=>f(this,null,function*(){try{if(S){const e=yield W(S);D(e.data.data)}else K.error("无效的下载参数")}catch(e){console.error("Error fetching settlement data:",e)}}),R=(e,r)=>{c(e),m(r)},_=e=>{const r=e.target.value;c(1),o(r),localStorage.setItem(`${d}_priceType`,r)};return a.useEffect(()=>{w?I(!1):h.current&&h.current.triggerSearch()},[n,i,s]),t.jsxs("div",{style:{padding:"20px"},children:[t.jsx(M,{ref:h,selectedType:p,setSelectedType:u,handleSearch:b,onDownload:z,storagePrefix:d}),t.jsx("div",{className:"mt-5",children:t.jsx($.Group,{name:"priceType",value:s,onChange:_,options:[{value:"all",label:"全部"},{value:"greaterThan7.5",label:"大于7.5"},{value:"lessThanEqual7.5",label:"小于7.5"}]})}),t.jsx("div",{style:{marginTop:"20px",minWidth:"300px"},children:t.jsx(q,{spinning:C,children:y.length>0?t.jsxs("div",{children:[t.jsx(A,{columns:P,dataSource:y,pagination:!1}),t.jsx(B,{className:"mt-5",current:n,pageSize:i,total:g,onChange:R,showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:[20,50,100],align:"center"})]}):t.jsx("div",{style:{textAlign:"center",marginTop:"60px"},children:t.jsxs("p",{style:{fontSize:"16px"},children:[t.jsx("i",{className:"fas fa-exclamation-circle",style:{marginRight:"8px",color:"#f39c12"}}),"请选择电网场地搜索数据"]})})})})]})}export{Y as default};
