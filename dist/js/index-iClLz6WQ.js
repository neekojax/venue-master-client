var L=(i,u,h)=>new Promise((a,s)=>{var c=x=>{try{w(h.next(x))}catch(g){s(g)}},r=x=>{try{w(h.throw(x))}catch(g){s(g)}},w=x=>x.done?a(x.value):Promise.resolve(x.value).then(c,r);w((h=h.apply(i,u)).next())});import{j as t,a as J,b as V}from"./index-BdoezwgC.js";import{r as p}from"./react-BIszHAjf.js";import{u as I,w as G}from"./xlsx-DaVhO591.js";import"./index-Cd3bGM7W.js";import{d as B}from"./install-Dn5CJfUk.js";import{j as M,k as f,h as $,bf as D,_ as Q,T as y,b5 as X,bg as K,bh as Y,bi as Z,Z as ee,q as te,B as ie,be as oe,W as re,z as _,U as P}from"./antd-BQr4HBC_.js";import{a as le}from"./api-B5aXIaK0.js";import"./install-52PPXTA7.js";import"./fetchHelper-BYcr7rCw.js";const se=i=>{const u=p.useRef(null),{effective:h,theoretical:a}=i,s=a>0?h/a*100:0;return console.log(s),p.useEffect(()=>{const c=B(u.current),r={series:[{type:"gauge",startAngle:210,endAngle:-30,min:0,max:100,splitNumber:5,radius:"90%",center:["50%","55%"],axisLine:{lineStyle:{width:15,color:[[.6,"#ff4d4f"],[.8,"#fa8c16"],[1,"#52c41a"]]}},pointer:{width:8},detail:{valueAnimation:!0,formatter:"{value}%",fontSize:20,offsetCenter:[0,80]},data:[{value:s.toFixed(2)}]}]};return c.setOption(r),()=>{c.dispose()}},[s]),t.jsx("div",{ref:u,style:{height:200,width:"100%"}})},z=i=>{const{values:u,colors:h}=i,a=i.values.reduce((c,r)=>c+r,0),s=i.values.map(c=>c/a*100);return t.jsxs("div",{style:{width:"100%"},children:[t.jsx("div",{style:{display:"flex",marginBottom:4,width:"100%"},children:u.map((c,r)=>t.jsxs("div",{style:{width:`${s[r]}%`,fontWeight:"bold",fontSize:14,color:"#000",whiteSpace:"nowrap",textAlign:r==0?"left":r==1?"center":r==2?"right":"center",paddingLeft:r===0?4:0,paddingRight:r===u.length-1?4:0,boxSizing:"border-box",visibility:r===3?"hidden":"visible"},title:`${s[r].toFixed(2)}%`,children:[c,"%"]},r))}),t.jsx("div",{style:{display:"flex",width:"100%",height:20,borderRadius:4,overflow:"hidden"},children:s.map((c,r)=>t.jsx("div",{style:{width:`${c}%`,backgroundColor:h[r],borderTopLeftRadius:r===0?4:0,borderBottomLeftRadius:r===0?4:0,borderTopRightRadius:r===s.length-1?4:0,borderBottomRightRadius:r===s.length-1?4:0,transition:"width 0.3s ease"}},r))})]})},ne=({data:i})=>{var c,r,w,x,g,T,k,N,b;const u=p.useRef(null),h=p.useRef(null),a=i.totalFailures24h/i.totalMachines*100,s=i.totalPowerImpact/i.totalTheoreticalPower*100;return p.useEffect(()=>{if(u.current){h.current=B(u.current);const j=i.totalEstimateOnRackMachines,v=i.totalEstimateOnlineMachines,R=i.totalMachines,C={tooltip:{trigger:"item"},grid:{top:-10,bottom:0,left:0,right:0},series:[{name:"总数",type:"pie",radius:["80%","100%"],label:{show:!1,position:"center",formatter:`{b}
{c}`},data:[{value:R,name:"总数",itemStyle:{color:"#fa8c16"}}]},{name:"在架数",type:"pie",radius:["55%","75%"],label:{show:!1},data:[{value:j,name:"在架",itemStyle:{color:"#1890ff"}},{value:R-j,name:"未在架",itemStyle:{color:"transparent"}}]},{name:"在线数",type:"pie",radius:["30%","50%"],label:{show:!1},data:[{value:v,name:"在线",itemStyle:{color:"#52c41a"}},{value:j-v,name:"不在线",itemStyle:{color:"transparent"}}]}]};h.current.setOption(C);const A=()=>h.current&&h.current.resize();return window.addEventListener("resize",A),()=>{window.removeEventListener("resize",A),h.current&&h.current.dispose()}}},[i]),t.jsxs(M,{gutter:16,children:[t.jsx(f,{span:8,children:t.jsxs($,{title:"机器汇总",bordered:!1,actions:[t.jsxs("span",{children:[t.jsx(D,{style:{color:"red",fontSize:16,marginRight:"10px"}}),t.jsxs("span",{children:["故障率：",(i.totalFailures24h/i.totalMachines*100).toFixed(2),"%"]})]},"setting"),t.jsxs("span",{children:[t.jsx(Q,{style:{color:"green",fontSize:16,marginRight:"10px"}}),t.jsxs("span",{children:["在线率：",(c=i.totalOnlineRatio)==null?void 0:c.toFixed(2),"%"]})]},"setting")],children:[t.jsxs(M,{justify:"space-between",align:"middle",children:[t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"托管台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalMachines})]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"在架台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalEstimateOnRackMachines})]}),t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"故障台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:i==null?void 0:i.totalFailures24h})]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:"在线台数："}),t.jsx(y.Text,{style:{width:80,display:"inline-block",textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:((i==null?void 0:i.totalEstimateOnlineMachines)||0).toFixed(0)})]})]}),t.jsx("div",{ref:u,style:{width:"100%",height:168,marginTop:0,marginBottom:0}})]})}),t.jsx(f,{span:8,children:t.jsxs($,{title:"算力汇总",bordered:!1,actions:[t.jsxs("span",{children:[t.jsx(X,{style:{fontSize:16,color:"#1890ff",marginRight:"10px"}}),t.jsxs("span",{children:["算力有效率：",(r=(i==null?void 0:i.averageEffectiveRate)||0)==null?void 0:r.toFixed(2),"%"]})]},"setting")],children:[t.jsxs(M,{justify:"space-between",align:"middle",children:[t.jsxs(f,{span:12,style:{textAlign:"left"},children:["有效算力：",((i==null?void 0:i.totalTheoreticalPower)*(i==null?void 0:i.averageEffectiveRate)/100).toFixed(2),"  EH/S"]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:["理论算力：",(w=i==null?void 0:i.totalTheoreticalPower)==null?void 0:w.toFixed(2),"  EH/S"]})]}),t.jsx(se,{effective:(i==null?void 0:i.totalTheoreticalPower)*(i==null?void 0:i.averageEffectiveRate)/100,theoretical:i==null?void 0:i.totalTheoreticalPower})]})}),t.jsx(f,{span:8,children:t.jsxs($,{title:"影响占比",children:[t.jsx("div",{style:{height:"20px"}}),t.jsx(z,{values:[Number(s==null?void 0:s.toFixed(2))],colors:["#52c41a","#ff4d4f","#faad14"]}),t.jsx("div",{style:{height:"50px"}}),t.jsx(z,{values:[Number(a==null?void 0:a.toFixed(2)),Number((x=i.totalLimitImpactRatio)==null?void 0:x.toFixed(2)),Number((g=i.totalHighTemperatureImpactRatio)==null?void 0:g.toFixed(2)),s-Number(a==null?void 0:a.toFixed(2))-Number((T=i.totalLimitImpactRatio)==null?void 0:T.toFixed(2))-Number((k=i.totalHighTemperatureImpactRatio)==null?void 0:k.toFixed(2))],colors:["#1890ff","#ff4d4f","#faad14"]}),t.jsxs("div",{style:{marginTop:60,marginBottom:-20,display:"flex",flexWrap:"wrap",borderTop:"1px solid #e8e8e8"},children:[t.jsxs(M,{justify:"space-between",align:"middle",style:{padding:12},children:[t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(K,{style:{color:"#faad14",marginRight:8}}),"影响占比：",s==null?void 0:s.toFixed(2),"%"]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(D,{style:{color:"#ff4d4f",marginRight:8}}),"总故障率：",a==null?void 0:a.toFixed(2),"%"]}),t.jsxs(f,{span:12,style:{textAlign:"left"},children:[t.jsx(Y,{style:{color:"#faad14",marginRight:8}}),"限电占比：",(N=i.totalLimitImpactRatio)==null?void 0:N.toFixed(2),"%"]}),t.jsxs(f,{span:12,style:{textAlign:"right"},children:[t.jsx(Z,{style:{color:"#ff4d4f",marginRight:8}}),"高温占比：",(b=i.totalHighTemperatureImpactRatio)==null?void 0:b.toFixed(2),"%"]})]}),t.jsx("div",{})]})]})})]})},ge=()=>{const{poolType:i}=J(V(["poolType"])),u=p.useRef(null),[h,a]=p.useState(!1);p.useEffect(()=>{const e=()=>{if(u.current){const o=u.current.getBoundingClientRect().top;a(o<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const s=new Date;s.setDate(s.getDate()-1);const c=s.toISOString().split("T")[0],[r,w]=p.useState(c),[x,g]=p.useState([]),T=e=>{g(e)},[k,N]=p.useState({}),[b,j]=p.useState([]),[v,R]=p.useState([]),[C,A]=p.useState([]),[H,W]=p.useState(20),U=[{title:"场地名",dataIndex:"venueName",key:"venueName",fixed:"left",width:200,render:e=>{const o=e==="Arct-HF01-J XP-AR-US"||e==="ARCT Technologies-HF02-AR-US";return t.jsx(_,{title:e,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:t.jsxs("div",{style:{width:"100%",overflow:"hidden",color:o?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:o?"bold":"normal"},children:[o&&t.jsx(P,{color:"red",style:{marginLeft:2},children:"补充"}),e]})})},sorter:(e,o)=>e.venueName.localeCompare(o.venueName),defaultSortOrder:"ascend"},{title:"账户名",dataIndex:"accountName",key:"accountName",fixed:"left",width:170,render:(e,o)=>{const d=o.ownerType===0?t.jsx(P,{color:"blue",style:{padding:"0px 2px"},children:"自营"}):t.jsx(P,{color:"green",style:{padding:"0px 2px"},children:"客户"});return t.jsxs(t.Fragment,{children:[`${e}`,"  ",d]})}},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,o)=>e.btcOutput24h-o.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,o)=>e.theoreticalPower-o.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,o)=>e.power24h-o.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.effectiveRate24h-o.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,o)=>e.totalMachines-o.totalMachines},{title:"在线数",dataIndex:"onlineMachines",key:"onlineMachines",width:100,align:"right"},{title:"在线率",dataIndex:"onlineRatio",key:"onlineRatio",width:100,align:"right",render:e=>t.jsx("span",{children:`${e}%`})},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:e=>t.jsx("span",{children:e}),sorter:(e,o)=>e.totalFailures-o.totalFailures},{title:"总故障率",dataIndex:"totalFailures",key:"totalMachines",width:100,align:"right",render:(e,o)=>{if(Number(o.totalMachines)===0)return t.jsx("span",{children:"0%"});const d=(e/o.totalMachines*100).toFixed(2);return t.jsx("span",{children:`${d}%`})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,o)=>e.failures24h-o.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>({children:`${e.toFixed(2)}%`,props:{style:{color:e>20?"#ff4d4f":"inherit"}}}),sorter:(e,o)=>e.failureRate24h-o.failureRate24h},{title:"影响算力(E)",dataIndex:"powerImpact",key:"powerImpact",width:130,align:"right",render:e=>e.toFixed(6),sorter:(e,o)=>e.powerImpact-o.powerImpact},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.impactRatio-o.impactRatio},{title:"影响产出(BTC)",dataIndex:"outputImpact",key:"outputImpact",width:145,align:"right",render:e=>e.toFixed(8),sorter:(e,o)=>e.outputImpact-o.outputImpact},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.limitImpactRate-o.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,o)=>e.highTemperatureRate-o.highTemperatureRate},{title:"事件描述",dataIndex:"events",key:"events",width:400,render:e=>t.jsx(_,{title:e,children:t.jsx("div",{className:"line-clamp-2",children:e})})}];p.useEffect(()=>{L(void 0,null,function*(){const o=Array.isArray(r)?r[0]:r;try{const d=yield le(i,o);if(d&&d.data&&d.data.dailyReportStatistics){const O=d.data.dailyReportStatistics,E=d.data.summary,F=Object.keys(O).map(m=>{const n=O[m];return{key:m,venueName:n.venue_name,accountId:n.account_id,accountName:n.account_name,ownerType:n.owner_type,btcOutput24h:n.btcOutput24h||0,theoreticalPower:n.theoreticalPower||0,power24h:n.power24h||0,effectiveRate24h:n.effectiveRate24h||0,totalMachines:n.totalMachines||0,totalFailures:n.totalFailures||0,onlineMachines:n.onlineMachines||0,onlineRatio:n.onlineRatio||0,failures24h:n.failures24h||0,failureRate24h:n.failureRate24h||0,powerImpact:n.powerImpact||0,impactRatio:n.impactRatio||0,outputImpact:n.outputImpact||0,limitImpactRate:n.limitImpactRate||0,highTemperatureRate:n.highTemperatureRate||0,events:n.events||""}});j(F),R(F);const l=F.map(m=>({value:m.accountName,label:m.accountName})),S=Array.from(new Map(l.map(m=>[m.value,m])).values());A(S),N(E)}else console.error("API 返回的 dailyReportStatistics 无效:",d)}catch(d){console.error("获取日报数据失败:",d)}})},[r,i]),p.useEffect(()=>{if(x.length>0){console.log(x);const e=b.filter(o=>x.includes(o.accountName));R(e.sort((o,d)=>o.accountName.localeCompare(d.accountName)))}else R(b.sort((e,o)=>e.accountName.localeCompare(o.accountName)))},[x,b]);const q=()=>{const e=v.map(l=>({场地名:l.venueName,账户名:l.accountName,账户类型:l.ownerType===0?"自营":"客户","24小时产出（BTC）":l.btcOutput24h.toFixed(8),"理论算力（E）":l.theoreticalPower.toFixed(6),"24小时算力（E）":l.power24h.toFixed(8),"24小时有效率":l.effectiveRate24h.toFixed(2)+"%",托管台数:l.totalMachines.toLocaleString(),在线数:l.onlineMachines.toLocaleString(),在线率:l.onlineRatio+"%",总故障台数:l.totalFailures.toLocaleString(),总故障率:Number(l.totalFailures)>0&&Number(l.totalMachines)>0?(Number(l.totalFailures)/Number(l.totalMachines)*100).toFixed(2)+"%":"0%","24小时故障数":l.failures24h.toLocaleString(),"24小时故障率":l.failureRate24h.toFixed(2)+"%","影响算力（E）":l.powerImpact.toFixed(8),影响占比:l.impactRatio.toFixed(2)+"%","影响产出（BTC）":l.outputImpact.toFixed(8),限电影响:l.limitImpactRate+"%",高温影响:l.highTemperatureRate+"%",限电算力:(l.theoreticalPower*1e6*l.limitImpactRate/100).toFixed(2)+"Th/s",高温算力:(l.theoreticalPower*1e6*l.highTemperatureRate/100).toFixed(2)+"Th/s",事件描述:l.events})),o=I.json_to_sheet(e),d=I.book_new(),O={fill:{fgColor:{rgb:"00BFFF"}},font:{color:{rgb:"FFFFFF"},bold:!0}},E=o["!ref"];if(E){const l=I.decode_range(E);for(let S=l.s.c;S<=l.e.c;S++){const m=I.encode_cell({r:0,c:S});o[m]&&(o[m].s=O)}}const F=[{wch:30},{wch:20},{wch:20},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:15},{wch:50}];o["!cols"]=F,I.book_append_sheet(d,o,"运营日报"),G(d,`运营日报_${r}.xlsx`)};return t.jsxs("div",{className:"min-h-screen",children:[t.jsxs("div",{className:"mx-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:["运营日报",t.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[" (",r||c,")"]})]}),t.jsx(ee,{className:"w-40",placeholder:"选择日期",onChange:(e,o)=>{w(o)}})]}),t.jsx(ne,{data:k})]}),t.jsxs("div",{ref:u,style:{borderRadius:"3px"},className:`mb-6 border-radius-3  rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${h?"sticky top-0 z-10":""}`,children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsx(te,{mode:"multiple",size:"middle",placeholder:"选择账户",style:{minWidth:"200px"},options:C,onChange:T,maxTagCount:3}),t.jsx(ie,{type:"primary",icon:t.jsx(oe,{}),onClick:q,className:"!rounded-button",children:"导出报表"})]}),t.jsx(re,{columns:U,dataSource:v,scroll:{x:1500},sticky:!0,pagination:{pageSize:H,showSizeChanger:!0,onShowSizeChange:e=>{W(e)},showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table"})]})]}),t.jsx("style",{children:`
        .ant-table-wrapper {
          height: 100%;
          overflow: auto;
        }

        .ant-table {
          height: 100%;
        }

        .custom-table .ant-table-thead > tr > th {
          background-color: rgba(250, 250, 252, 1);
          font-weight: 600;
        }

        /* .custom-table .ant-table-tbody > tr:hover > td {
        //   background-color: #f0f7ff;
        // }

        // .custom-table .ant-table-tbody > tr:nth-child(even) {
        //   background-color: #fafafa;
        // }*/

        .line-clamp-2 {
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `})]})};export{ge as default};
