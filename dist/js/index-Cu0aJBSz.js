var S=Object.defineProperty,T=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var I=(i,a,t)=>a in i?S(i,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[a]=t,v=(i,a)=>{for(var t in a||(a={}))E.call(a,t)&&I(i,t,a[t]);if(b)for(var t of b(a))H.call(a,t)&&I(i,t,a[t]);return i},M=(i,a)=>T(i,q(a));var y=(i,a,t)=>new Promise((l,u)=>{var h=o=>{try{c(t.next(o))}catch(n){u(n)}},p=o=>{try{c(t.throw(o))}catch(n){u(n)}},c=o=>o.done?l(o.value):Promise.resolve(o.value).then(h,p);c((t=t.apply(i,a)).next())});import{j as s}from"./index-B-9wpXJx.js";import{m as O,r as f}from"./react-BIszHAjf.js";import{F as m,B as A,W as L,a3 as B,Z as w,I as k,d as _,K as g,a1 as K}from"./antd-BlFR_sXc.js";import{e as V,f as z,g as U,h as W}from"./hook-salifrvu.js";import"./useQuery-BIYchmya.js";import"./useMutation-BOfiG2kC.js";import"./api-CMHuAJKC.js";import"./fetchHelper-4p_Wj_6l.js";const ae=()=>{const i=O(),a=i.venueId,t=i.poolId,{data:l,isLoading:u}=V(t),h=z(),p=U(),c=W(),[o,n]=f.useState(!1),[x,j]=f.useState(null),[d]=m.useForm(),N=f.useMemo(()=>{var e;return(e=l==null?void 0:l.data)!=null?e:[]},[l]),F=()=>{j(null),n(!0),d.resetFields(),d.setFieldsValue({venue_id:Number(a),pool_id:Number(t)})},P=e=>{j(e),n(!0),d.setFieldsValue({id:e.id,venue_id:e.venue_id,pool_id:e.pool_id,start_time:_(e.start_time),end_time:_(e.end_time),theoretical_hashrate:e.theoretical_hashrate,hosted_machine:e.hosted_machine})},D=()=>y(void 0,null,function*(){const e=yield d.validateFields(),r={venue_id:Number(a),pool_id:Number(t),hosted_machine:Number(e.hosted_machine),theoretical_hashrate:Number(e.theoretical_hashrate),start_time:typeof e.start_time=="string"?e.start_time:_(e.start_time).format("YYYY-MM-DD HH:mm:ss"),end_time:typeof e.end_time=="string"?e.end_time:_(e.end_time).format("YYYY-MM-DD HH:mm:ss")};try{x?(yield p.mutateAsync(M(v({},r),{id:x.id})),g.success("已更新")):(yield h.mutateAsync(r),g.success("已新增")),n(!1),d.resetFields()}catch(R){console.log(R)}}),Y=e=>y(void 0,null,function*(){try{yield c.mutateAsync(e.id),g.success("已删除")}catch(r){console.log(r)}}),C=[{title:"开始时间",dataIndex:"start_time",key:"start_time"},{title:"结束时间",dataIndex:"end_time",key:"end_time"},{title:"理论算力",dataIndex:"theoretical_hashrate",key:"theoretical_hashrate"},{title:"托管机器",dataIndex:"hosted_machine",key:"hosted_machine",align:"right"},{title:"操作",key:"action",width:160,render:(e,r)=>s.jsxs("div",{className:"flex gap-3",children:[s.jsx("a",{onClick:()=>P(r),children:"修改"}),s.jsx(K,{title:"确认删除该记录？",onConfirm:()=>Y(r),okText:"删除",cancelText:"取消",children:s.jsx("a",{children:"删除"})})]})}];return s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[s.jsxs("div",{className:"text-lg font-semibold",children:["操作记录（venueId: ",a,", poolId: ",t,"）"]}),s.jsx(A,{type:"primary",onClick:F,children:"新增记录"})]}),s.jsx(L,{rowKey:"id",loading:u,columns:C,dataSource:N,pagination:{pageSize:20}}),s.jsx(B,{title:x?"编辑记录":"新增记录",open:o,onOk:D,onCancel:()=>n(!1),confirmLoading:h.isPending||p.isPending,destroyOnClose:!0,children:s.jsxs(m,{form:d,layout:"vertical",preserve:!1,children:[s.jsx(m.Item,{label:"开始时间",name:"start_time",rules:[{required:!0,message:"请选择开始时间"}],children:s.jsx(w,{showTime:!0,style:{width:"100%"}})}),s.jsx(m.Item,{label:"结束时间",name:"end_time",rules:[{required:!0,message:"请选择结束时间"}],children:s.jsx(w,{showTime:!0,style:{width:"100%"}})}),s.jsx(m.Item,{label:"理论算力",name:"theoretical_hashrate",rules:[{required:!0,message:"请输入理论算力"}],children:s.jsx(k,{type:"number",placeholder:"请输入理论算力"})}),s.jsx(m.Item,{label:"托管机器",name:"hosted_machine",rules:[{required:!0,message:"请输入托管机器"}],children:s.jsx(k,{type:"number",placeholder:"请输入托管机器"})})]})})]})};export{ae as default};
