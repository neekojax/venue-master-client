var b=(d,n,o)=>new Promise((i,u)=>{var f=l=>{try{h(o.next(l))}catch(x){u(x)}},y=l=>{try{h(o.throw(l))}catch(x){u(x)}},h=l=>l.done?i(l.value):Promise.resolve(l.value).then(f,y);h((o=o.apply(d,n)).next())});import{j as t,a as A,b as B}from"./index-CSV4XiKE.js";import{r as c,L}from"./react-BIszHAjf.js";import{R as $}from"./index-1tdOFsmr.js";import{q as S,x as w,o as N,bh as z,s as I,I as M,J as P,B as k,bb as T,T as O,v as _,K as q,G,O as V,E as J}from"./antd-qZ2UPrev.js";import{u as K}from"./useAuthRedirect-BEYkOELL.js";import{f as U}from"./api-Bkvm2S2Y.js";import"./install-DJKZGxT7.js";import"./index-Cwm2rK8R.js";import"./fetchHelper-CvxtIUNk.js";const{Title:D,Paragraph:X}=O,Q=({onChange:d,venueNum:n,subAccountNum:o})=>t.jsxs("div",{className:"headerSection",children:[t.jsxs(S,{justify:"space-between",align:"middle",style:{flexWrap:"wrap",marginBottom:16},children:[t.jsx(w,{wrap:!0,align:"start",children:t.jsxs(N,{vertical:!0,gap:"0.825rem",children:[t.jsxs(D,{level:3,style:{marginBottom:0},children:[t.jsx("span",{style:{marginRight:"0.5rem"},children:t.jsx(z,{className:"stat-value-blue"})}),"场地运行指标概览"]}),t.jsx(X,{style:{color:"#999"},children:"实时监控各数据中心的运行状态和关键指标数据"})]})}),t.jsx(w,{style:{marginBottom:16,background:"#f9fafe",border:"rgba(238,238,242) solid 1px",borderRadius:"0.625rem",padding:"0.625rem 1rem"},wrap:!0,align:"start",children:t.jsxs(N,{justify:"space-between",gap:"0.725rem",children:[t.jsx(I,{title:t.jsx("span",{className:"title",children:"总场地数"}),value:n,formatter:i=>t.jsx("span",{className:"stat-value stat-value-blue",children:i})}),t.jsx("div",{className:"vertical-divider"}),t.jsx(I,{title:t.jsx("span",{className:"title",children:"子账户数"}),value:o,formatter:i=>t.jsx("span",{className:"stat-value stat-value-green",children:i})})]})})]}),t.jsx(S,{justify:"space-between",align:"middle",style:{flexWrap:"wrap",marginBottom:16},className:"border",children:t.jsxs(w,{wrap:!0,children:[t.jsx(M,{className:"custom-input",placeholder:"搜索场地/子账户",onChange:d,prefix:t.jsx(P,{}),style:{width:240},size:"middle"}),t.jsx(k,{icon:t.jsx(T,{}),size:"middle",children:"导出数据"})]})})]});function ie(){K();const{poolType:d}=A(B(["poolType"])),[n,o]=c.useState(null),[i,u]=c.useState([]),[f,y]=c.useState(""),[h,l]=c.useState(!0),[x,R]=c.useState(0),[C,H]=c.useState(0),E=e=>b(this,null,function*(){var s;try{l(!0);const a=yield U(e);o(a==null?void 0:a.data);const r=(a==null?void 0:a.data)||[],p={};r.forEach(j=>{const v=j.venueName;v&&(p[v]=j)});const g=Object.values(p||{});R(g==null?void 0:g.length),H((s=r==null?void 0:r.length)!=null?s:0)}catch(a){console.log("服务异常，请稍后重试",a),J.error("服务异常，请稍后重试")}finally{l(!1)}}),F=e=>{if(!Array.isArray(e)||(e==null?void 0:e.length)===0)return t.jsx("div",{children:"数据不足"});const s=e.map(a=>a.efficiency);return(s==null?void 0:s.length)<2?t.jsx("div",{children:"数据不足"}):(console.log("monthEfficiencys",e),console.log("efficiencies",s),t.jsx($,{option:{tooltip:{trigger:"axis"},xAxis:{type:"category",data:e.map(a=>a.time),show:!1},yAxis:{type:"value",show:!1},series:[{name:"效率",type:"bar",barWidth:8,data:s,barGap:"1",itemStyle:{color:"#4e81ee"},symbol:"none"}],grid:{left:"0%",right:"0%",bottom:"0%",top:"0%"}},style:{height:"40px",width:"100px"}}))};c.useEffect(()=>{E(d),u([{title:"场地",dataIndex:"venueName",fixed:"left",width:250,render:e=>{var a;const s=e==="Arct-HF01-J XP-AR-US"||e==="ARCT Technologies-HF02-AR-US";return t.jsx(_,{title:e,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:t.jsxs("div",{style:{width:"100%",overflow:"hidden",color:s?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:s?"bold":"normal"},children:[s&&t.jsx(q,{color:"red",style:{marginLeft:2},children:"补充"}),t.jsx(L,{to:`/venue/detail/${((a=n==null?void 0:n.find(r=>r.venueName===e))==null?void 0:a.venueCode)||"unknown"}`,className:"text-blue-500 hover:underline",children:e})]})})}},{title:"子账户",dataIndex:"name",width:160},{title:"理论算力 (PH/s)",dataIndex:"theoreticalHashRate",width:125,sorter:(e,s)=>e.theoreticalHashRate-s.theoreticalHashRate},{title:"24h算力",dataIndex:"lastHash",width:120,render:e=>{const[s,a]=e.split(" ");return t.jsxs("span",{children:[s," ",t.jsx("span",{style:{color:"gray"},children:a})," "]})}},{title:"当前达成率",dataIndex:"currentEffective",width:120,render:e=>t.jsxs("span",{className:`${e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600"}`,children:[e.toFixed(2),"%"]}),sorter:(e,s)=>e.currentEffective-s.currentEffective},{title:"昨日算力达成率",dataIndex:"lastDayEffective",width:140,render:e=>t.jsxs("span",{className:`${e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600"}`,children:[e.toFixed(2),"%"]}),sorter:(e,s)=>e.lastDayEffective-s.lastDayEffective},{title:"上周算力达成率",dataIndex:"lastWeekHashEfficiency",width:140,render:e=>t.jsxs("span",{className:`${e>=90?"text-green-600":e>=80?"text-yellow-600":"text-red-600"}`,children:[e.toFixed(2),"%"]}),sorter:(e,s)=>e.lastWeekHashEfficiency-s.lastWeekHashEfficiency},{title:"周算力达成率增幅",dataIndex:"weekGrowth",width:160,render:(e,s)=>{const a=s.lastWeekHashEfficiency-s.last2WeekHashEfficiency,r=a.toFixed(2),p=a>0?"text-green-600":"text-red-600";return t.jsxs("span",{className:p,children:[r,"%"]})}},{title:"昨日故障率",dataIndex:"lastDayFault",width:120,render:()=>"-"},{title:"上周故障率",dataIndex:"lastWeekFault",width:120,render:()=>"-"},{title:"周故障率增幅",dataIndex:"lastWeekFaultDiff",width:120,key:"lastWeekFaultDiff",render:()=>"-"},{title:"月达成率趋势",dataIndex:"monthEfficiencys",width:120,render:(e,s)=>F(s.monthEfficiencys)},{title:"月故障率趋势",dataIndex:"historyMonthFault",width:120,render:()=>"-"},{title:"观察者链接",dataIndex:"observerLink",width:100,render:(e,s)=>{const a=s.link;return t.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800",children:"查看"})}},{title:"导出",key:"export",fixed:"right",width:80,render:()=>t.jsx(k,{type:"text",icon:t.jsx(T,{}),className:"!rounded-button whitespace-nowrap"})}])},[d]);const W=e=>{y(e.target.value)};if(h)return t.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:t.jsx(G,{tip:"加载中..."})});const m=n==null?void 0:n.filter(e=>[e.venueName,e.name].some(a=>String(a).toLowerCase().includes(f.toLowerCase()))).sort((e,s)=>{const a=e.venueName.toLowerCase(),r=s.venueName.toLowerCase();return a.localeCompare(r)});return t.jsxs("div",{style:{padding:"20px"},className:"longdataTable",children:[t.jsx(Q,{onChange:W,venueNum:x,subAccountNum:C}),t.jsx(V,{loading:h,columns:i,dataSource:m,scroll:{x:1800,y:800},sticky:!0,style:{fontSize:"clamp(0.75rem, 2vw, 1rem)"},className:"custom-table",pagination:{position:["bottomCenter"],showSizeChanger:!0,pageSizeOptions:["20","30","50"],defaultPageSize:20,showTotal:e=>`共 ${e} 条`,total:(m==null?void 0:m.length)||0,onChange:()=>{const e=document.querySelector(".ant-table-body");e&&(e.scrollTop=0)}},onRow:()=>({onMouseEnter:()=>{const e=document.querySelector(".ant-table-body");if(e){const{scrollTop:s,scrollHeight:a,clientHeight:r}=e;a-s-r<50&&console.log("触发加载更多")}}})})]})}export{ie as default};
