var le=Object.defineProperty,re=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var R=(l,s,o)=>s in l?le(l,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[s]=o,A=(l,s)=>{for(var o in s||(s={}))ce.call(s,o)&&R(l,o,s[o]);if(q)for(var o of q(s))ue.call(s,o)&&R(l,o,s[o]);return l},B=(l,s)=>re(l,ie(s));var O=(l,s,o)=>new Promise((m,p)=>{var y=c=>{try{h(o.next(c))}catch(g){p(g)}},n=c=>{try{h(o.throw(c))}catch(g){p(g)}},h=c=>c.done?m(c.value):Promise.resolve(c.value).then(y,n);h((o=o.apply(l,s)).next())});import{a as N,b as U,j as e}from"./index-CTW2SOmh.js";import{r as d,L as de}from"./react-BIszHAjf.js";import{F as me,a as he}from"./index-BkK42E6M.js";import{g as pe,A as ye,a as xe}from"./short-link-s_eo4ee_.js";import{E as _e}from"./index-BnbAj48N.js";import{u as ge}from"./useAuthRedirect-BqT3dC3N.js";import{f as fe}from"./excel-35wNsxPv.js";import{u as K}from"./hook-DAoplPwf.js";import{F as r,q as x,I as i,z,U as be,a0 as je,a1 as we,a2 as ve,N as I,K as _,y as w,Q as Se,B as ke,V as Ie,a3 as Ce,a4 as C}from"./antd-DyiLpPLO.js";import{u as Pe,a as Ne,b as Te,c as Me}from"./hook-Bt6iXfRr.js";import"./iconBase-DmfS09tz.js";import"./fetchHelper-C0alrpJ8.js";import"./xlsx-DaVhO591.js";import"./useQuery-DFRoF6uu.js";import"./useMutation-BK_-1skh.js";import"./api-H8rjveU7.js";import"./api-mvsQSQhA.js";const{Option:Fe}=x,$e=[{label:"场地",name:"venue_id",component:x},{label:"子账户",name:"pool_name",component:i},{label:"场地主体",name:"pool_type",component:i},{label:"所属国家",name:"country",component:i},{label:"托管机器",name:"hosted_machine",component:i},{label:"理论算力",name:"theoretical_hashrate",component:i},{label:"能耗比",name:"energy_ratio",component:i},{label:"基础托管费",name:"basic_hosting_fee",component:i},{label:"主链接",name:"master_link",component:i},{label:"备用链接",name:"backup_link",component:i}];function Ee({initialValues:l,onFormInstanceReady:s}){const[o]=r.useForm(),m=N(n=>n.poolType);d.useEffect(()=>{o.setFieldsValue({pool_type:m})},[m]);const{poolType:p}=N(U(["poolType"])),{data:y}=K(p);return d.useEffect(()=>{s(o)},[o,s]),e.jsx(r,{layout:"horizontal",form:o,name:"form_in_modal",initialValues:l,preserve:!1,labelAlign:"left",labelCol:{flex:"100px"},wrapperCol:{flex:10},className:"mt-4",children:$e.map(n=>{var h;return e.jsx(r.Item,{label:n.label,name:n.name,rules:[{required:!0,message:`请输入${n.label}`}],children:n.component===x&&n.name==="venue_id"?e.jsx(x,{placeholder:`请选择 ${n.label}`,children:(h=y==null?void 0:y.data)==null?void 0:h.map(c=>e.jsxs(Fe,{value:c.id,children:[" ",c.venue_name]},c.id))}):e.jsx(i,{placeholder:`请输入${n.label}`,disabled:n.name==="pool_type",type:n.name==="theoretical_hashrate"||n.name==="energy_ratio"||n.name==="basic_hosting_fee"?"number":"text"})},n.name)})})}const{Option:P}=x,Le={name:"",pool_type:"",country:"",status:0,hosted_machine:0,theoretical_hashrate:0,energy_ratio:0,basic_hosting_fee:0,master_link:"",backup_link:""},V="mining-setting";function et(){var D;ge();const{poolType:l}=N(U(["poolType"])),[s,o]=d.useState(localStorage.getItem(`${V}_poolCategory`)||"主矿池"),{data:m,isLoading:p}=Pe(l,s),[y,n]=d.useState([]),[h,c]=d.useState([]),g=Ne(),G=Te(),H=Me(),[J,v]=d.useState(!1),[T,W]=d.useState(""),[M,S]=d.useState(!1),[f,Q]=d.useState(null),[F,X]=d.useState(0),{data:k}=K(l),[b]=r.useForm(),Y=a=>{Q(a),X(a.key),S(!0)},Z=()=>{b.validateFields().then(a=>{if(f){const t=B(A({},a),{id:f.id});E(F,t),S(!1),b.resetFields()}})},ee=()=>{S(!1)},te=({status:a})=>{let t="",u={};return a===1?(t="活跃",u={color:"green"}):a===0&&(t="暂停",u={color:"red"}),e.jsx("span",{style:u,children:t})};if(d.useEffect(()=>{if(m&&m.data){const a=m.data.map((t,u)=>({serialNumber:u+1,key:t.id,pool_id:t.id,venue_id:t.venue_info.id,venue_name:t.venue_info.venue_name,pool_name:t.pool_name,country:t.country,hosted_machine:t.hosted_machine,status:t.status,pool_category:t.pool_category,theoretical_hashrate:t.theoretical_hashrate,energy_ratio:t.energy_ratio,basic_hosting_fee:t.basic_hosting_fee,link:t.link}));c(a)}M&&b.setFieldsValue(f)},[m,f,F]),d.useEffect(()=>{n([{dataIndex:"serialNumber",key:"serialNumber",width:40,render:(a,t)=>{const{link:u}=t;return u.includes("antpool")?e.jsx(me,{style:{color:"green",fontSize:16}}):u.includes("f2pool")?e.jsx(he,{style:{color:"orange",fontSize:16}}):e.jsx("span",{children:t.serialNumber})}},{title:"场地",dataIndex:"venue_name",key:"venue_name",width:200,render:a=>{const t=a==="Arct-HF01-J XP-AR-US";return e.jsx(z,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsxs("div",{style:{width:"100%",overflow:"hidden",color:t?"red":"#333",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:t?"bold":"normal"},children:[a,t&&e.jsx(be,{color:"red",style:{marginLeft:2},children:"补充"})]})})}},{title:"子账户",dataIndex:"pool_name",key:"pool_name",width:200,render:(a,t)=>e.jsx(z,{title:a,placement:"top",overlayInnerStyle:{color:"white"},style:{color:"white"},children:e.jsx("div",{style:{width:"100%",overflow:"hidden",color:"#333",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.jsxs(de,{to:`/mining/detail/${t.venue_id}/${t.pool_id}`,className:"text-blue-500 hover:underline",children:[" ",a]})})})},{title:"场地类型",dataIndex:"pool_category",key:"pool_category",width:75},{title:"所属国家",dataIndex:"country",key:"country",width:75},{title:"托管机器",dataIndex:"hosted_machine",key:"hosted_machine",width:75},{title:"状态",dataIndex:"status",key:"status",width:75,filters:[{text:"活跃",value:1},{text:"暂停",value:0}],onFilter:(a,t)=>t.status===a,render:(a,t)=>e.jsx(te,{status:t.status})},{title:"理论算力(PH/s)",dataIndex:"theoretical_hashrate",key:"theoretical_hashrate",width:140,sorter:(a,t)=>a.theoretical_hashrate-t.theoretical_hashrate},{title:"能耗比(J/T)",dataIndex:"energy_ratio",key:"energy_ratio",width:120},{title:"基础托管费($/kwh)",dataIndex:"basic_hosting_fee",key:"basic_hosting_fee",width:150},{title:"链接",dataIndex:"link",key:"link",width:200,render:a=>e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",style:{color:"#1E90FF",fontSize:12},title:a,children:a.length>40?pe(a):a})},{title:"操作",valueType:"option1",key:"operation",width:100,render:(a,t)=>e.jsxs(e.Fragment,{children:[e.jsx("a",{onClick:()=>Y(t),style:{marginRight:"7px"},children:e.jsx(je,{})},`edit-${t.key}`),e.jsx(we,{title:"确认删除此记录吗？",onConfirm:()=>$(t.key),okText:"是",cancelText:"否",children:e.jsx("a",{children:e.jsx(ve,{style:{color:"red"}})},`delete-${t.key}`)})]})}])},[]),p)return e.jsx(I,{tip:"加载中..."});const ae=a=>O(this,null,function*(){v(!0),g.mutate(a,{onSuccess:()=>{_.success("添加成功"),v(!1)},onError:t=>{_.error(`添加失败: ${t.message}`),v(!1)}})}),$=a=>new Promise(()=>{H.mutate(a,{onSuccess:()=>{_.success("删除记录成功")},onError:t=>{_.error(`删除记录失败: ${t.message}`)}})}),E=(a,t)=>{const u={id:a,venue_id:t.venue_id,pool_name:t.pool_name,pool_type:l,country:t.country,hosted_machine:Number(t.hosted_machine),status:t.status,pool_category:t.pool_category,theoretical_hashrate:String(t.theoretical_hashrate),energy_ratio:String(t.energy_ratio),basic_hosting_fee:String(t.basic_hosting_fee),link:t.link};return new Promise(()=>{G.mutate(u,{onSuccess:()=>{_.success("更新成功")},onError:j=>{_.error(`更新失败: ${j.message}`)}})})},oe=a=>{o(a.target.value),localStorage.setItem(`${V}_poolCategory`,a.target.value)},se=()=>{fe(L)},ne=a=>{W(a.target.value)},L=h.filter(a=>Object.values(a).some(t=>String(t).toLowerCase().includes(T.toLowerCase()))).sort((a,t)=>{const u=a.venue_name.toLowerCase(),j=t.venue_name.toLowerCase();return u<j?-1:u>j?1:0});return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("div",{className:"flex",children:e.jsx("div",{className:"mr-4",children:e.jsxs(w.Group,{className:"filterRadio",onChange:oe,value:s,children:[e.jsx(w.Button,{value:"主矿池",children:"主矿池"}),e.jsx(w.Button,{value:"备用矿池",children:"备用矿池"})]})})}),e.jsxs("div",{children:[e.jsx(i,{prefix:e.jsx(Se,{style:{color:"rgba(0, 0, 0, 0.25)"},size:18}),placeholder:"请输入搜索字段",value:T,onChange:ne,style:{width:250},className:"text-sm mr-10"}),e.jsx(ye,{label:"添加矿池",initialValues:Le,onSubmit:ae,FormComponent:Ee,mode:xe.ADD}),e.jsx(ke,{icon:e.jsx(Ie,{className:"exportIcon"}),size:"middle",className:"text-blue-500 exportButton",style:{marginLeft:"10px"},onClick:se,children:"导出"})]})]}),J&&e.jsx(I,{tip:"正在添加矿池...",size:"large",style:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1e3}}),p?e.jsx(I,{style:{marginTop:20}}):e.jsx(_e,{tableData:L,setTableData:c,columns:y,handleDelete:$,handleSave:E}),e.jsx(Ce,{title:"修改矿池",className:"editModal",closable:{"aria-label":"Custom Close Button"},open:M,onOk:Z,onCancel:ee,children:e.jsxs(r,{name:"basic",form:b,labelCol:{span:8},wrapperCol:{span:16},style:{maxWidth:600},initialValues:{remember:!0},autoComplete:"off",children:[e.jsx(r.Item,{label:"子账户名称",name:"pool_name",rules:[{required:!0,message:"Please input your pool pool_name!"}],children:e.jsx(i,{})}),e.jsx(r.Item,{label:"场地",name:"venue_id",rules:[{required:!0,message:"请选择场地!"}],children:e.jsx(x,{placeholder:"请选择场地",allowClear:!0,style:{width:"100%"},children:(D=k==null?void 0:k.data)==null?void 0:D.map(a=>e.jsxs(P,{value:a.id,children:[a.venue_name," "]},a.id))})}),e.jsx(r.Item,{label:"场地类型",name:"pool_category",rules:[{required:!0,message:"Please input your pool_category!"}],children:e.jsxs(x,{placeholder:"请选择场地类型",allowClear:!0,style:{backgroundColor:"white"},children:[e.jsx(P,{value:"主矿池",children:"主矿池"}),e.jsx(P,{value:"备用矿池",children:"备用矿池"})]})}),e.jsx(r.Item,{label:"所属国家",name:"country",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(i,{})}),e.jsx(r.Item,{label:"托管机器",name:"hosted_machine",rules:[{required:!0,message:"Please input your 托管机器!"}],children:e.jsx(i,{})}),e.jsx(r.Item,{label:"状态",name:"status",rules:[{required:!0,message:"Please input your country!"}],children:e.jsx(w.Group,{name:"radiogroup",defaultValue:1,options:[{value:0,label:"暂停"},{value:1,label:"活跃"}]})}),e.jsx(r.Item,{label:"理论算力",name:"theoretical_hashrate",rules:[{required:!0,message:"Please input your theoretical_hashrate!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(r.Item,{label:"能耗比",name:"energy_ratio",rules:[{required:!0,message:"Please input your energy_ratio!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(r.Item,{label:"基础托管费",name:"basic_hosting_fee",rules:[{required:!0,message:"Please input your basic_hosting_fee!"}],children:e.jsx(C,{style:{width:200},min:"0",max:"100000",step:"0.01",stringMode:!0})}),e.jsx(r.Item,{label:"Link",name:"link",rules:[{required:!0,message:"Please input your link!"}],children:e.jsx(i,{})})]})})]})}export{et as default};
