var R=(c,u,s)=>new Promise((r,n)=>{var l=o=>{try{f(s.next(o))}catch(h){n(h)}},p=o=>{try{f(s.throw(o))}catch(h){n(h)}},f=o=>o.done?r(o.value):Promise.resolve(o.value).then(l,p);f((s=s.apply(c,u)).next())});import{j as i}from"./index-BPd5w9dz.js";import{e as S,g as y,m as E,r as d}from"./react-BIszHAjf.js";import{u as g,w as P}from"./xlsx-DaVhO591.js";import{d as w,B,be as A,W as C,Z as $}from"./antd-BlFR_sXc.js";import{b as M}from"./api-BsebH5pR.js";import"./fetchHelper-CWtxZZEr.js";var b={exports:{}};(function(c,u){(function(s,r){c.exports=r()})(S,function(){return function(s,r){r.prototype.isSameOrAfter=function(n,l){return this.isSame(n,l)||this.isAfter(n,l)}}})})(b);var _=b.exports;const z=y(_);var k={exports:{}};(function(c,u){(function(s,r){c.exports=r()})(S,function(){return function(s,r){r.prototype.isSameOrBefore=function(n,l){return this.isSame(n,l)||this.isBefore(n,l)}}})})(k);var L=k.exports;const V=y(L);w.extend(z);w.extend(V);const{RangePicker:G}=$,U=()=>{const c=E(),u=c.venueId,s=c.venueName,r=d.useRef(null),[n,l]=d.useState(!1),[p,f]=d.useState([]),[o,h]=d.useState([]),[F,I]=d.useState(20);d.useEffect(()=>{const e=()=>{if(r.current){const t=r.current.getBoundingClientRect().top;l(t<=0)}};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const j=[{title:"日期",dataIndex:"date",key:"date",fixed:"left",width:120},{title:"24小时产出(BTC)",dataIndex:"btcOutput24h",key:"btcOutput24h",width:165,align:"right",render:e=>e.toFixed(8),sorter:(e,t)=>e.btcOutput24h-t.btcOutput24h},{title:"理论算力(E)",dataIndex:"theoreticalPower",key:"theoreticalPower",width:125,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.theoreticalPower-t.theoreticalPower},{title:"24小时算力(E)",dataIndex:"power24h",key:"power24h",width:145,align:"right",render:e=>e.toFixed(6),sorter:(e,t)=>e.power24h-t.power24h},{title:"24小时有效率",dataIndex:"effectiveRate24h",key:"effectiveRate24h",width:140,align:"right",render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.effectiveRate24h-t.effectiveRate24h},{title:"托管台数",dataIndex:"totalMachines",key:"totalMachines",width:105,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.totalMachines-t.totalMachines},{title:"总故障台数",dataIndex:"totalFailures",key:"totalFailures",width:120,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.totalFailures-t.totalFailures},{title:"总故障率",key:"totalFailureRate",width:120,align:"right",render:(e,t)=>{const m=t.totalMachines?(t.totalFailures/t.totalMachines*100).toFixed(2):"0.00";return i.jsxs("span",{children:[m,"%"]})}},{title:"24小时故障数",dataIndex:"failures24h",key:"failures24h",width:138,align:"right",render:e=>e.toLocaleString(),sorter:(e,t)=>e.failures24h-t.failures24h},{title:"24小时故障率",dataIndex:"failureRate24h",key:"failureRate24h",width:138,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.failureRate24h-t.failureRate24h},{title:"影响占比",dataIndex:"impactRatio",key:"impactRatio",width:105,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.impactRatio-t.impactRatio},{title:"限电影响",dataIndex:"limitImpactRate",key:"limitImpactRate",width:140,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.limitImpactRate-t.limitImpactRate},{title:"高温影响",dataIndex:"highTemperatureRate",key:"highTemperatureRate",width:140,render:e=>`${e.toFixed(2)}%`,sorter:(e,t)=>e.highTemperatureRate-t.highTemperatureRate}];d.useEffect(()=>{R(void 0,null,function*(){try{const t=yield M(Number(u));if(t&&t.data){const m=t.data.map(a=>({date:a.date||"",btcOutput24h:a.btcOutput24h||0,theoreticalPower:a.theoreticalPower||0,power24h:a.power24h||0,effectiveRate24h:a.effectiveRate24h||0,totalMachines:a.totalMachines||0,totalFailures:a.totalFailures||0,failures24h:a.failures24h||0,failureRate24h:a.failureRate24h||0,impactRatio:a.impactRatio||0,limitImpactRate:a.limitImpactRate||0,highTemperatureRate:a.highTemperatureRate||0}));f(m),h(m)}else console.error("API 返回无效:",t)}catch(t){console.error("获取日报数据失败:",t)}})},[u]);const[O,T]=d.useState(null),D=e=>{if(T(e),console.log(O,e),e){const[t,m]=e,a=p.filter(v=>{const x=w(v.date);return x.isValid()&&x.isSameOrAfter(t,"day")&&x.isSameOrBefore(m,"day")});h(a)}else h(p)},N=()=>{if(!o.length)return;const e=g.json_to_sheet(o),t=g.book_new();g.book_append_sheet(t,e,"日报数据"),P(t,"日报数据.xlsx")};return i.jsxs("div",{className:"min-h-screen",children:[i.jsx("header",{className:"mb-0",children:i.jsx("div",{className:"flex items-center gap-4 mb-3",children:i.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s})})}),i.jsxs("div",{ref:r,className:`mb-6 rounded-lg bg-white p-6 shadow-sm transition-all duration-300 ${n?"sticky top-0 z-10":""}`,children:[i.jsxs("div",{className:"mb-6 flex items-center justify-between gap-4",children:[i.jsx(G,{onChange:D}),i.jsx(B,{type:"primary",icon:i.jsx(A,{}),onClick:N,className:"!rounded-button",children:"导出报表"})]}),i.jsx("div",{className:"mx-auto",children:i.jsx(C,{columns:j,dataSource:o,scroll:{x:1200},sticky:!0,pagination:{pageSize:F,showSizeChanger:!0,onShowSizeChange:(e,t)=>I(t),showQuickJumper:!0,showTotal:e=>`共 ${e} 条`},className:"custom-table",rowKey:"date"})})]})]})};export{U as default};
